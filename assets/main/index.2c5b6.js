window.__require=function e(t,o,n){function r(c,s){if(!o[c]){if(!t[c]){var a=c.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var u=o[c]={exports:{}};t[c][0].call(u.exports,function(e){return r(t[c][1][e]||e)},u,u.exports,e,t,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({"abstract-factory":[function(e,t,o){"use strict";cc._RF.push(t,"921b0YHEMFHsYwqY0VUc3k7","abstract-factory");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AbstractFactory=void 0;var i=function(){function e(e){this._assetProvider=e}return e.prototype.handleAssets=function(e,t){return n(this,void 0,Promise,function(){return r(this,function(o){switch(o.label){case 0:return[4,Promise.all(e.map(function(e){return t(e)}))];case 1:return o.sent(),[2]}})})},e.prototype.instantiateOnCanvas=function(e,t){var o=cc.director.getScene().getChildByName("Canvas"),n=this._assetProvider.instantiateAsset(e);n.setParent(o),n.setPosition(0,0);var r=n.getComponent(t);if(!r)throw new Error("instantiateOnCanvas: Component not found");return r},e.prototype.loadAssets=function(){throw new Error("Method not implemented.")},e.prototype.cleanUp=function(){throw new Error("Method not implemented.")},e}();o.AbstractFactory=i,cc._RF.pop()},{}],"abstract-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"12e0f+oUC5L6ax28zq0B55H","abstract-mechanic");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AbstractMechanic=void 0;var i=e("./mechanic-event-system"),c=e("./mechanic-types"),s=function(){function e(e,t){this._tileFactory=e,this._sheduler=t,this._fillEmptyDelay=200,this.mechanicType=c.MechanicType.Basic}return e.prototype.init=function(e,t){this._tableController=e,this._tableModel=t},e.prototype.onTurnEnd=function(){throw new Error("Method not implemented.")},e.prototype.onTileClick=function(e){return n(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return cc.log("click ",e),[4,new Promise(function(e){return e(!1)})];case 1:return[2,t.sent()]}})})},e.prototype.dropTiles=function(){return n(this,void 0,Promise,function(){var e=this;return r(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){for(var o=e._tableModel.getTileCount(),n=o.columns,r=o.rows,i=0;i<n;i++)for(var c=r-1;c>=0;c--)if(!e._tableModel.getTile(i,c))for(var s=c-1;s>=0;s--){var a=e._tableModel.getTile(i,s);if(a){e._tableModel.setTile(i,c,a),e._tableModel.setTile(i,s,null),e._tableModel.onDropTileAction(a,e._tableModel.getCell(i,c).getPosition()),e._tableModel.getCell(i,c).setFree(!1),e._tableModel.getCell(i,s).setFree(!0),t();break}}t()})];case 1:return t.sent(),[2]}})})},e.prototype.fillEmpty=function(){return n(this,void 0,Promise,function(){var e,t,o,n,i,c,s;return r(this,function(r){switch(r.label){case 0:return[4,this.delay(this._fillEmptyDelay)];case 1:for(r.sent(),e=this._tableModel.getTileCount(),t=e.columns,o=e.rows,n=0;n<t;n++)for(i=0;i<o;i++)this._tableModel.getTile(n,i)||(c=this._tableModel.getCell(n,i),s=this._tileFactory.createRandomTile(c),this._tableModel.setTile(n,i,s),c.setFree(!1),this._tableModel.onAddTile(s,c));return[2]}})})},e.prototype.dispatchUseMechanicEvent=function(){i.MechanicEventSystem.dispatch({type:i.MechanicEventType.MECHANIC_USED,mechanic:this,mechanicType:this.mechanicType})},e.prototype.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},e}();o.AbstractMechanic=s,cc._RF.pop()},{"./mechanic-event-system":"mechanic-event-system","./mechanic-types":"mechanic-types"}],"asset-provider":[function(e,t,o){"use strict";cc._RF.push(t,"b345b5XtVRAHreIMCXEIqDi","asset-provider");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AssetProvider=void 0;var i=function(){function e(){this._assets={}}return e.prototype.loadAsset=function(e){return n(this,void 0,Promise,function(){var t=this;return r(this,function(){return this._assets[e]?[2,this._assets[e]]:[2,new Promise(function(o,n){cc.resources.load(e,function(r,i){if(r)return cc.error("Failed to load asset: "+e,r),void n(r);t._assets[e]=i,o(i)})})]})})},e.prototype.getAsset=function(e){return this._assets[e]},e.prototype.instantiateAsset=function(e){return this._assets[e]?cc.instantiate(this._assets[e]):(cc.error("Asset not found: "+e),null)},e.prototype.unloadAsset=function(e){this._assets[e]&&(cc.resources.release(e),delete this._assets[e])},e}();o.AssetProvider=i,cc._RF.pop()},{}],"basic-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"b7740EWJ5tK7pmA/ZOz0Zh0","basic-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BasicMechanic=void 0;var s=e("./abstract-mechanic"),a=e("./mechanic-types"),l=function(e){function t(t,o){var n=e.call(this,t,o)||this;return n.mechanicType=a.MechanicType.Basic,n}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(o){switch(o.label){case 0:return(t=this.findConnectedTiles(e)).length<2?(this._tableController.onFalseBurned(e),[2,!1]):(this._tableController.beforeBurnGroupAction(e,t.length),this.burnTiles(t),[4,this.dropTiles()]);case 1:return o.sent(),[4,this.fillEmpty()];case 2:return o.sent(),this._tableController.onBurnAction&&this._tableController.onBurnAction(t.length),this.dispatchUseMechanicEvent(),[2,!0]}})})},t.prototype.onTurnEnd=function(){},t.prototype.findConnectedTiles=function(e){if(!e||!this._tableController)return[];for(var t=this._tableModel.getTileCount(),o=new Set,n=[e],r=e.tileType,i=[{col:-1,row:0},{col:1,row:0},{col:0,row:-1},{col:0,row:1}];n.length>0;){var c=n.pop();if(!o.has(c)){o.add(c);var s=this._tableModel.getTilePosition(c);if(s)for(var a=0,l=i;a<l.length;a++){var u=l[a],p=s.col+u.col,h=s.row+u.row;if(!(p<0||h<0||p>=t.columns||h>=t.rows)){var f=this._tableModel.getTile(p,h);f&&!o.has(f)&&f.tileType===r&&n.push(f)}}}}return Array.from(o)},t.prototype.burnTiles=function(e){var t=this;e.forEach(function(e){var o=t._tableModel.getTilePosition(e),n=o.col,r=o.row;n>=0&&r>=0&&(t._tableController.onClearTile(e),t._tableModel.setTile(n,r,null),t._tableModel.getCell(n,r).setFree(!0))})},t}(s.AbstractMechanic);o.BasicMechanic=l,cc._RF.pop()},{"./abstract-mechanic":"abstract-mechanic","./mechanic-types":"mechanic-types"}],"booster-bomb-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"88fb2FhSS5Hi5ZpYpuptDU+","booster-bomb-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterBombMechanic=void 0;var s=e("./abstract-mechanic"),a=e("./mechanic-types"),l=function(e){function t(t,o,n){var r=e.call(this,t,n)||this;return r.RADIUS=o.boosterBombR,r.mechanicType=a.MechanicType.BombBoster,r}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t,o,n,r,i,s,a,l,u,p,h,f,d=this;return c(this,function(c){switch(c.label){case 0:if(this._tableController.onBombAction(e),t=this._tableModel.getTilePosition(e),o=t.col,n=t.row,o<0||n<0)return[2,!1];for(r=this._tableModel.getTileCount(),i=r.columns,s=r.rows,a=[],l=-this.RADIUS;l<=this.RADIUS;l++)for(u=-this.RADIUS;u<=this.RADIUS;u++)h=n+u,(p=o+l)>=0&&p<i&&h>=0&&h<s&&(f=this._tableModel.getTile(p,h))&&a.push(f);return 0===a.length?[2,!1]:(this._tableController.beforeBombAction(e,a.length),a.forEach(function(e){var t=d._tableModel.getTilePosition(e);d._tableController.onClearTile(e),d._tableModel.setTile(t.col,t.row,null),d._tableModel.getCell(t.col,t.row).setFree(!0)}),[4,this.dropTiles()]);case 1:return c.sent(),[4,this.fillEmpty()];case 2:return c.sent(),this._tableController.onBurnAction&&this._tableController.onBurnAction(a.length),this.dispatchUseMechanicEvent(),this.onTurnEnd(),[2,!0]}})})},t.prototype.onTurnEnd=function(){this._tableController.onTurnEnd()},t}(s.AbstractMechanic);o.BoosterBombMechanic=l,cc._RF.pop()},{"./abstract-mechanic":"abstract-mechanic","./mechanic-types":"mechanic-types"}],"booster-handler":[function(e,t,o){"use strict";cc._RF.push(t,"26db8bMyIRE7q9TmY+bfmKV","booster-handler"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterHandler=void 0;var n=e("./mechanic-event-system"),r=e("./mechanic-types"),i=function(){function e(e,t){this.updateCallbacks=[],this._bombTrials=e,this._teleportTrials=t,n.MechanicEventSystem.subscribe(this)}return e.prototype.onMechanicEvent=function(e){e.type===n.MechanicEventType.MECHANIC_USED&&(e.mechanicType===r.MechanicType.BombBoster?this.consumeBomb():e.mechanicType===r.MechanicType.TeleportBoster&&this.consumeTeleport())},e.prototype.consumeBomb=function(){this._bombTrials>0&&(this._bombTrials--,this.notifyUpdate())},e.prototype.consumeTeleport=function(){this._teleportTrials>0&&(this._teleportTrials--,this.notifyUpdate())},e.prototype.onUpdate=function(e){this.updateCallbacks.push(e)},e.prototype.notifyUpdate=function(){this.updateCallbacks.forEach(function(e){return e()})},e.prototype.getBombTrials=function(){return this._bombTrials},e.prototype.getTeleportTrials=function(){return this._teleportTrials},e.prototype.unsubscribes=function(){n.MechanicEventSystem.unsubscribe(this),this.updateCallbacks=[]},e}();o.BoosterHandler=i,cc._RF.pop()},{"./mechanic-event-system":"mechanic-event-system","./mechanic-types":"mechanic-types"}],"config-types":[function(e,t,o){"use strict";cc._RF.push(t,"b89131m6NtDT4D3MgmZYQLU","config-types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],configs:[function(e,t,o){"use strict";cc._RF.push(t,"cc9b28JaFxFzoHL/6aJzNPq","configs"),Object.defineProperty(o,"__esModule",{value:!0}),o.CONFIGS=void 0;var n=e("../game-logic/tile-type"),r=[{id:0,maxSteps:15,winScoreThreshold:50},{id:1,maxSteps:12,winScoreThreshold:40},{id:2,maxSteps:10,winScoreThreshold:45},{id:3,maxSteps:9,winScoreThreshold:50},{id:4,maxSteps:8,winScoreThreshold:55},{id:5,maxSteps:7,winScoreThreshold:60},{id:6,maxSteps:7,winScoreThreshold:65},{id:7,maxSteps:8,winScoreThreshold:70},{id:8,maxSteps:8,winScoreThreshold:75},{id:9,maxSteps:9,winScoreThreshold:80},{id:10,maxSteps:9,winScoreThreshold:85},{id:11,maxSteps:10,winScoreThreshold:90},{id:12,maxSteps:10,winScoreThreshold:95},{id:13,maxSteps:11,winScoreThreshold:100},{id:14,maxSteps:11,winScoreThreshold:105},{id:15,maxSteps:12,winScoreThreshold:110},{id:16,maxSteps:12,winScoreThreshold:115},{id:17,maxSteps:13,winScoreThreshold:120},{id:18,maxSteps:13,winScoreThreshold:125},{id:19,maxSteps:14,winScoreThreshold:130}],i={boosterBombR:1,scoreFormulaIndex:1,bombTrials:3,teleportTrials:3},c=[{formula:function(e){return e*e*5}},{formula:function(e){return e}}],s=new(function(){function e(){}return e.prototype.getConditionNextMap=function(e){return e%10==0},e.prototype.getScoreFormula=function(){return c[i.scoreFormulaIndex].formula},e.prototype.getLevel=function(e){return r.find(function(t){return t.id===e})||(cc.error("Level with id "+e+" not found return 0 level"),r[0])},e}()),a={tablePrefab:"table/Table",uIPanelPrefab:"table/UI",bombEffectPrefab:"table/ExplosionEffect",tilePrefab:"tiles/TilePrefab",labelPrefab:"table/label",resultLevelView:"result-level-view/ResultLevelView",getAll:function(){return u(this)}},l={map:[{id:0,roadmapPrefabPath:"menu/Roadmap"}],getAll:function(){return u(this)},getRoadmapPrefabById:function(e){var t=this.map.find(function(t){return t.id===e});return!t&&(cc.error("Roadmap with id "+e+" not found"),this.map.length-1<e)?this.map[0].roadmapPrefabPath:t.roadmapPrefabPath}};function u(e){return Object.values(e).filter(function(e){return"string"==typeof e})}var p=[{path:"tiles/block_blue",type:n.TileType.BLUE},{path:"tiles/block_green",type:n.TileType.GREEN},{path:"tiles/block_purpure",type:n.TileType.PURPLE},{path:"tiles/block_red",type:n.TileType.RED},{path:"tiles/block_yellow",type:n.TileType.YELLOW}];o.CONFIGS={TABLE:[{column:9,lines:9,grid:95},{column:6,lines:6,grid:95}],TILE_MODELS:p,PREFABS:a,PREFABS_MENU:l,GAME_LEVELS:r,CONSTANTS:i,SCORE_FORMULAS:c,GAME_CONFIG:s,PERSISTENTS_PREFABS:{curtainPrefab:"curtain/Curtain"}},cc._RF.pop()},{"../game-logic/tile-type":"tile-type"}],"create-level-content-state":[function(e,t,o){"use strict";cc._RF.push(t,"5d92cOCridFpI41IeupB2o6","create-level-content-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.CreateLevelContentState=void 0;var i=e("../../game-logic/game-mechanic/booster-handler"),c=e("../../game-logic/game-mechanic/mechanic-controller"),s=e("../../game-logic/progress-level-controller"),a=e("../../game-logic/ui/ui-panel-controller"),l=e("../state-machine/state-names"),u=function(){function e(e){this._tableView=null,this._uiPanelView=null,this._tilesFactory=null,this._vfxFactory=null,this._progressService=null,this._levelService=null,this._constantsConfig=null;var t=e.stateMachine,o=e.gameFactory,n=e.tilesFactory,r=e.vfxFactory,i=e.progressService,c=e.levelService,s=e.constantsConfig;this._stateMachine=t,this._gameFactory=o,this._tilesFactory=n,this._vfxFactory=r,this._progressService=i,this._levelService=c,this._constantsConfig=s}return e.prototype.run=function(){return n(this,void 0,Promise,function(){return r(this,function(e){switch(e.label){case 0:return cc.log("run create level content state"),[4,this._gameFactory.loadAssets()];case 1:return e.sent(),this.createContent(),[2]}})})},e.prototype.createContent=function(){this.createViews();var e=this.createTableCells(),t=this.createTiles(e),o=this.createTableModel(e,t),n=this.createTableController(o),r=this.createMechanicController(this._tableView,n,o);n.setMechanicController(r);var i=this.createBoosterHandler(),c=this.createProgressController(),s=this.createUIPanelController(r,i,c);this.startGameLoopState(o,n,i,c,s)},e.prototype.createViews=function(){this._tableView=this._gameFactory.createTableView(),this._uiPanelView=this._gameFactory.createUiPanelView()},e.prototype.createTableCells=function(){var e=this._tableView.getContent();return this._gameFactory.createTableCells(e)},e.prototype.createTiles=function(e){return this._tilesFactory.createTiles(e)},e.prototype.createTableModel=function(e,t){return this._gameFactory.createTableModel(e,t)},e.prototype.createTableController=function(e){return this._gameFactory.createTableController(this._tableView,e,this._vfxFactory)},e.prototype.createMechanicController=function(e,t,o){return new c.MechanicController(e,this._tilesFactory,t,o,this._constantsConfig)},e.prototype.createBoosterHandler=function(){return new i.BoosterHandler(this._constantsConfig.bombTrials,this._constantsConfig.teleportTrials)},e.prototype.createProgressController=function(){return new s.ProgressLevelController(this._progressService,this._levelService)},e.prototype.createUIPanelController=function(e,t,o){return new a.UIPanelController(o,this._progressService,this._uiPanelView,e,t)},e.prototype.startGameLoopState=function(e,t,o,n,r){this._stateMachine.run(l.StateNames.GameLoop,{tableModel:e,tableController:t,uiPanelView:this._uiPanelView,uiPanelController:r,boosterHandler:o,progressController:n})},e.prototype.stop=function(){cc.log("stop create content state")},e}();o.CreateLevelContentState=u,cc._RF.pop()},{"../../game-logic/game-mechanic/booster-handler":"booster-handler","../../game-logic/game-mechanic/mechanic-controller":"mechanic-controller","../../game-logic/progress-level-controller":"progress-level-controller","../../game-logic/ui/ui-panel-controller":"ui-panel-controller","../state-machine/state-names":"state-names"}],"create-menu-state":[function(e,t,o){"use strict";cc._RF.push(t,"03c48It63NBjLbIEWgOt6/e","create-menu-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.CreateMenuState=void 0;var i=e("../../menu/roadmap/roadmap-controller"),c=e("../state-machine/state-names"),s=function(){function e(e){var t=e.stateMachine,o=e.menuFactory,n=e.levelService;this._stateMachine=t,this._menuFactory=o,this._levelService=n}return e.prototype.run=function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return cc.log("run create menu content state"),[4,this._menuFactory.loadAssets()];case 1:return e.sent(),this.createContent(),this._stateMachine.run(c.StateNames.MenuState),[2]}})})},e.prototype.createContent=function(){var e=this._menuFactory.createRoadmap();new i.RoadmapController({roadmap:e,levelService:this._levelService,stateMachine:this._stateMachine})},e.prototype.stop=function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this._menuFactory.loadAssets()];case 1:return e.sent(),[2]}})})},e}();o.CreateMenuState=s,cc._RF.pop()},{"../../menu/roadmap/roadmap-controller":"roadmap-controller","../state-machine/state-names":"state-names"}],curtain:[function(e,t,o){"use strict";cc._RF.push(t,"8309dgtnxtJqLUdtZYjvtY0","curtain");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},c=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.Curtain=void 0;var a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fadeSprite=null,t.curtainSprite=null,t._startPosCurtain=null,t}return r(t,e),t.prototype.onLoad=function(){this.curtainSprite&&this.curtainSprite.node&&(this._startPosCurtain=this.curtainSprite.node.position)},t.prototype.showCurtain=function(){return c(this,void 0,Promise,function(){var e=this;return s(this,function(){return cc.Tween.stopAllByTarget(this.curtainSprite.node),this.showFade(!0),[2,new Promise(function(t){cc.tween(e.curtainSprite.node).to(.3,{x:0},{easing:"quadOut"}).delay(.3).call(function(){t()}).start()})]})})},t.prototype.hideCurtain=function(){return c(this,void 0,Promise,function(){var e=this;return s(this,function(){return cc.Tween.stopAllByTarget(this.curtainSprite.node),this.showFade(!1),[2,new Promise(function(t){cc.tween(e.curtainSprite.node).to(.6,{x:e._startPosCurtain.x},{easing:"quadOut"}).call(function(){t(),e.node.destroy()}).start()})]})})},t.prototype.showFade=function(e){e?cc.tween(this.fadeSprite.node).to(.3,{opacity:200}).start():cc.tween(this.fadeSprite.node).to(.3,{opacity:0}).start()},t.prototype.onDestroy=function(){this.curtainSprite&&this.curtainSprite.node&&cc.Tween.stopAllByTarget(this.curtainSprite.node),this.fadeSprite&&this.fadeSprite.node&&cc.Tween.stopAllByTarget(this.fadeSprite.node)},i([u(cc.Sprite)],t.prototype,"fadeSprite",void 0),i([u(cc.Sprite)],t.prototype,"curtainSprite",void 0),i([l],t)}(cc.Component);o.Curtain=p,cc._RF.pop()},{}],"entry-point":[function(e,t,o){"use strict";cc._RF.push(t,"a9aa5EFkiRHk7gsuM2EnD8q","entry-point");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.EntryPoint=void 0;var c=e("../configs/configs"),s=e("./game"),a=e("./services/serviceLocator"),l=cc._decorator.ccclass,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){this.dontDestroyOnLoad(),this._game=new s.Game({serviceLocator:a.ServiceLocator.container(),prefabsConfig:c.CONFIGS.PREFABS,gameConfig:c.CONFIGS.GAME_CONFIG,tableConfig:c.CONFIGS.TABLE,tilesModelConfig:c.CONFIGS.TILE_MODELS,constantsConfig:c.CONFIGS.CONSTANTS,prefabsMenuConfig:c.CONFIGS.PREFABS_MENU,persistentsPrefabsConfig:c.CONFIGS.PERSISTENTS_PREFABS})},t.prototype.dontDestroyOnLoad=function(){cc.game.isPersistRootNode(this.node)||(this.node.parent=null,cc.game.addPersistRootNode(this.node))},i([l],t)}(cc.Component);o.EntryPoint=u,cc._RF.pop()},{"../configs/configs":"configs","./game":"game","./services/serviceLocator":"serviceLocator"}],"fly-text":[function(e,t,o){"use strict";cc._RF.push(t,"db7c7KAmCVL4LgFfSdV1WeM","fly-text");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.FlyText=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.moveDistance=100,t.duration=1.5,t}return r(t,e),t.prototype.start=function(){var e=this,t=this.node.position.clone();this.node.scale=0,this.node.opacity=0,this.node.position=cc.v3(t.x,t.y-20,t.z),cc.tween(this.node).delay(.1).parallel(cc.tween().to(.3,{scale:1.2},{easing:"backOut"}),cc.tween().to(.3,{opacity:255}),cc.tween().to(.3,{position:cc.v3(t.x,t.y+10,t.z)},{easing:"backOut"})).to(.1,{scale:1,position:cc.v3(t.x,t.y,t.z)}).parallel(cc.tween().to(this.duration,{position:cc.v3(t.x,t.y+this.moveDistance,t.z)},{easing:"circOut"}),cc.tween().delay(.3*this.duration).to(.7*this.duration,{opacity:0},{easing:"fade"})).call(function(){e.node.destroy()}).start()},i([a(cc.Label)],t.prototype,"label",void 0),i([a],t.prototype,"moveDistance",void 0),i([a],t.prototype,"duration",void 0),i([s],t)}(cc.Component);o.FlyText=l,cc._RF.pop()},{}],"game-factory":[function(e,t,o){"use strict";cc._RF.push(t,"a22c79dktBITo5Qf/ubjskH","game-factory");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var i=arguments[t],c=0,s=i.length;c<s;c++,r++)n[r]=i[c];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.GameFactory=void 0;var a=e("../../../curtain/curtain"),l=e("../../../game-logic/table/table-view"),u=e("../../../game-logic/table-cell"),p=e("../../../game-logic/table/table-model"),h=e("../../../game-logic/ui/ui-panel"),f=e("../../../game-logic/table/table-controller"),d=e("../../../game-logic/ui/result-level-view"),v=function(e){function t(t){var o=e.call(this,t.assetProvider)||this,n=t.assetProvider,r=t.prefabsConfig,i=t.tableConfig,c=t.tilesModelConfig,s=t.persistentsPrefabsConfig;return o._assetProvider=n,o._prefabsConfig=r,o._tableConfig=i,o._tilesModelConfig=c,o._persistentPrefabsConfig=s,o}return r(t,e),t.prototype.createUIResultView=function(){try{return this.instantiateOnCanvas(this._prefabsConfig.resultLevelView,d.ResultLevelView)}catch(e){cc.error("Failed to create ResultLevelView:",e)}},t.prototype.loadAssets=function(){return i(this,void 0,void 0,function(){var e,t=this;return c(this,function(o){switch(o.label){case 0:return e=s(this._prefabsConfig.getAll(),this._tilesModelConfig.map(function(e){return e.path})),[4,this.handleAssets(e,function(e){return t._assetProvider.loadAsset(e)})];case 1:return o.sent(),[2]}})})},t.prototype.createTableView=function(){try{return this.instantiateOnCanvas(this._prefabsConfig.tablePrefab,l.TableView)}catch(e){cc.error("Failed to create table:",e)}},t.prototype.createUiPanelView=function(){try{return this.instantiateOnCanvas(this._prefabsConfig.uIPanelPrefab,h.UiPanelView)}catch(e){cc.error("Failed to create UI panel:",e)}},t.prototype.createCurtain=function(){try{var e=cc.director.getScene().getChildByName("EntryPoint"),t=this._assetProvider.instantiateAsset(this._persistentPrefabsConfig.curtainPrefab).getComponent(a.Curtain);return t.node.setParent(e),t.node.setPosition(0,0),t}catch(o){cc.error("Failed to create curtain:",o)}},t.prototype.createTableController=function(e,t,o){return new f.TableController(e,t,o)},t.prototype.createTableModel=function(e,t){return new p.TableModel(e,t)},t.prototype.createTableCells=function(){for(var e=[],t=Math.floor(Math.random()*this._tableConfig.length),o=this._tableConfig[t],n=o.column,r=o.lines,i=o.grid,c=o.grid,s=-(n-1)*i/2,a=(r-1)*c/2,l=0;l<n;l++){e[l]=[];for(var p=0;p<r;p++){var h=new cc.Vec2(s+l*i,a-p*c),f=new u.TableCell(l,p,h,!0);e[l][p]=f}}return e},t.prototype.cleanUp=function(){return i(this,void 0,void 0,function(){var e,t=this;return c(this,function(o){switch(o.label){case 0:return e=s(this._prefabsConfig.getAll(),this._tilesModelConfig.map(function(e){return e.path})),[4,this.handleAssets(e,function(e){return t._assetProvider.unloadAsset(e)})];case 1:return o.sent(),[2]}})})},t}(e("./abstract-factory").AbstractFactory);o.GameFactory=v,cc._RF.pop()},{"../../../curtain/curtain":"curtain","../../../game-logic/table-cell":"table-cell","../../../game-logic/table/table-controller":"table-controller","../../../game-logic/table/table-model":"table-model","../../../game-logic/table/table-view":"table-view","../../../game-logic/ui/result-level-view":"result-level-view","../../../game-logic/ui/ui-panel":"ui-panel","./abstract-factory":"abstract-factory"}],"game-loop-state":[function(e,t,o){"use strict";cc._RF.push(t,"851aeQvhJ1KmZWYl006WD2h","game-loop-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoopState=void 0;var n=e("../state-machine/state-names"),r=function(){function e(e,t,o){this._stateMachine=e,this._progressService=t,this._movePlayerValidator=o,this._isResultShown=!1}return e.prototype.run=function(e){var t=this;this._isResultShown=!1,this._tableModel=e.tableModel,this._tableController=e.tableController,this._boosterHandler=e.boosterHandler,this._uiPanelController=e.uiPanelController,this._progressController=e.progressController,this.tryResolveMoves(),this._tableController.onBurnAction=this.handleBurnAction.bind(this),this._tableController.onEndTurnAction=this.tryResolveMoves.bind(this),this._tableController.onFalseBurned=this.handleFalseBurned.bind(this),this._progressController.onWinEvent=function(){return t.handleGameEnd("win","\u0443\u0441\u043f\u0435\u0445!")},this._progressController.onLoseEvent=function(){return t.handleGameEnd("lose","\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c\n \u0448\u0430\u0433\u0438...")}},e.prototype.handleBurnAction=function(e){this._progressService.nextStep(e),this._uiPanelController.updateScore(),this._progressController.checkProgress(),this.tryResolveMoves()},e.prototype.handleFalseBurned=function(e){this._boosterHandler.getBombTrials()>0&&this._uiPanelController.summonClickBomb(),this._isResultShown||this.hasBoosterTrials()||this._progressController.checkProgress(),this._tableController.onFalseBurnedAction(e),this.tryResolveMoves()},e.prototype.hasBoosterTrials=function(){return this._boosterHandler.getBombTrials()>0||this._boosterHandler.getTeleportTrials()>0},e.prototype.tryResolveMoves=function(){this._isResultShown||this.hasBoosterTrials()||this.resolveImpossibleMoves()},e.prototype.resolveImpossibleMoves=function(){this._movePlayerValidator.hasPossibleMoves(this._tableModel)||this.handleGameEnd("lose","\u043d\u0435\u0442\n \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432...")},e.prototype.handleGameEnd=function(e,t){this._tableController.onBurnAction=null,this._tableController.onFalseBurned=null,this._boosterHandler.unsubscribes(),this._isResultShown=!0,this._tableController.removeClickTileListeners(),this._uiPanelController.removeBoosterListeners(),this._stateMachine.run(n.StateNames.ResultState,{result:e,message:t,tableController:this._tableController})},e.prototype.stop=function(){},e}();o.GameLoopState=r,cc._RF.pop()},{"../state-machine/state-names":"state-names"}],"game-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"665bafOwBlEUZdBQC7YO+W7","game-mechanic"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"game-state-machine":[function(e,t,o){"use strict";cc._RF.push(t,"336a1fdwvFLYaOGZ3QrUEMe","game-state-machine");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.StateMachine=void 0;var i=function(){function e(e){this.currentState=null;var t=e.stateRegister,o=e.serviceLocator;this._states=t.registerStates({serviceLocator:o,stateMachine:this})}return e.prototype.run=function(e,t){var o;return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return(n=this._states[e])?[4,null===(o=this.currentState)||void 0===o?void 0:o.stop()]:(cc.error("State not registered:",e,"/ all keys: "+Object.keys(this._states)),[2]);case 1:return r.sent(),this.currentState=n,n.run(t),[2]}})})},e}();o.StateMachine=i,cc._RF.pop()},{}],"game-states-register":[function(e,t,o){"use strict";cc._RF.push(t,"1fdbauD4ZpDp6DJsVF1+EVV","game-states-register"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameStateRegister=void 0;var n=e("../states/initialize-state"),r=e("../states/create-level-content-state"),i=e("../services/factories/game-factory"),c=e("../services/factories/tile-factory"),s=e("../services/factories/vfx-factory"),a=e("../services/levels/progress-service"),l=e("../services/levels/level-service"),u=e("../states/game-loop-state"),p=e("../services/move-validator"),h=e("../states/result-state"),f=e("../states/create-menu-state"),d=e("../states/menu-state"),v=e("../services/factories/menu-factory"),y=e("../states/load-scene-state"),b=function(){function e(e){var t=e.tilesModelConfig,o=e.prefabsConfig,n=e.gameConfig,r=e.tableConfig,i=e.constantsConfig,c=e.prefabsMenuConfig,s=e.persistentsPrefabsConfig;this._gameConfig=n,this._tileModelConfig=t,this._prefabsConfig=o,this._tableConfig=r,this._constantsConfig=i,this._prefabsMenuConfig=c,this._persistentsPrefabsConfig=s}return e.prototype.registerStates=function(e){var t=e.serviceLocator,o=e.stateMachine,b={InitializeState:new n.InitializeState({stateMachine:o,serviceLocator:t,tileModelsConfig:this._tileModelConfig,prefabsConfig:this._prefabsConfig,gameConfig:this._gameConfig,tableConfig:this._tableConfig,tilesModelConfig:this._tileModelConfig,prefabsMenuConfig:this._prefabsMenuConfig,persistentsPrefabsConfig:this._persistentsPrefabsConfig}),CreateMenuState:new f.CreateMenuState({stateMachine:o,menuFactory:t.single(v.MenuFactory),levelService:t.single(l.LevelService)}),MenuState:new d.MenuState({stateMachine:o}),CreateLevelContentState:new r.CreateLevelContentState({stateMachine:o,gameFactory:t.single(i.GameFactory),tilesFactory:t.single(c.TileFactory),vfxFactory:t.single(s.VfxFactory),progressService:t.single(a.ProgressGameService),levelService:t.single(l.LevelService),constantsConfig:this._constantsConfig}),GameLoopState:new u.GameLoopState(o,t.single(a.ProgressGameService),t.single(p.MovePlayerValidator)),ResultState:new h.ResultState(o,t.single(i.GameFactory)),LoadSceneState:new y.LoadSceneState({gameFactory:t.single(i.GameFactory),stateMachine:o})};return cc.log("States registered:",Object.keys(b)),b},e}();o.GameStateRegister=b,cc._RF.pop()},{"../services/factories/game-factory":"game-factory","../services/factories/menu-factory":"menu-factory","../services/factories/tile-factory":"tile-factory","../services/factories/vfx-factory":"vfx-factory","../services/levels/level-service":"level-service","../services/levels/progress-service":"progress-service","../services/move-validator":"move-validator","../states/create-level-content-state":"create-level-content-state","../states/create-menu-state":"create-menu-state","../states/game-loop-state":"game-loop-state","../states/initialize-state":"initialize-state","../states/load-scene-state":"load-scene-state","../states/menu-state":"menu-state","../states/result-state":"result-state"}],game:[function(e,t,o){"use strict";cc._RF.push(t,"9468cogMLRPSL1kSlPBKw9q","game");var n=this&&this.__rest||function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};Object.defineProperty(o,"__esModule",{value:!0}),o.Game=void 0;var r=e("./state-machine/game-state-machine"),i=e("./state-machine/game-states-register"),c=e("./state-machine/state-names");o.Game=function(e){var t=e.serviceLocator,o=n(e,["serviceLocator"]);this._stateMachine=new r.StateMachine({serviceLocator:t,stateRegister:new i.GameStateRegister(o)}),this._stateMachine.run(c.StateNames.Initialize)},cc._RF.pop()},{"./state-machine/game-state-machine":"game-state-machine","./state-machine/game-states-register":"game-states-register","./state-machine/state-names":"state-names"}],"initialize-state":[function(e,t,o){"use strict";cc._RF.push(t,"81e10bI9VtLoLLZzzBQMAT3","initialize-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.InitializeState=void 0;var n=e("../services/asset-provider"),r=e("../services/factories/game-factory"),i=e("../services/factories/menu-factory"),c=e("../services/factories/tile-factory"),s=e("../services/factories/vfx-factory"),a=e("../services/levels/level-service"),l=e("../services/levels/progress-service"),u=e("../services/move-validator"),p=e("../state-machine/state-names"),h=function(){function e(e){cc.log("run RegisterDependecies");var t=e.stateMachine,o=e.serviceLocator,p=e.tileModelsConfig,h=e.prefabsConfig,f=e.gameConfig,d=e.tableConfig,v=e.tilesModelConfig,y=e.prefabsMenuConfig,b=e.persistentsPrefabsConfig;this._serviceLocator=o,this._stateMachine=t;var _=new n.AssetProvider,m=new a.LevelService(f),g=new r.GameFactory({assetProvider:_,prefabsConfig:h,tableConfig:d,tilesModelConfig:v,persistentsPrefabsConfig:b}),w=new i.MenuFactory({assetProvider:_,prefabsMenuConfig:y,persistentsPrefabsConfig:b,levelService:m});cc.log("MenuFactory created ",p);var T=new c.TileFactory({assetProvider:_,tileModelsConfig:p,prefabsConfig:h}),S=new s.VfxFactory(_,h),C=new l.ProgressGameService(m),P=new u.MovePlayerValidator;this._serviceLocator.registerSingle(_),this._serviceLocator.registerSingle(w),this._serviceLocator.registerSingle(g),this._serviceLocator.registerSingle(T),this._serviceLocator.registerSingle(S),this._serviceLocator.registerSingle(C),this._serviceLocator.registerSingle(P),this._serviceLocator.registerSingle(m),this._serviceLocator.registerSingle(C)}return e.prototype.run=function(){this._stateMachine.run(p.StateNames.CreateMenuState)},e.prototype.stop=function(){cc.log("Stopping RegisterDependecies")},e}();o.InitializeState=h,cc._RF.pop()},{"../services/asset-provider":"asset-provider","../services/factories/game-factory":"game-factory","../services/factories/menu-factory":"menu-factory","../services/factories/tile-factory":"tile-factory","../services/factories/vfx-factory":"vfx-factory","../services/levels/level-service":"level-service","../services/levels/progress-service":"progress-service","../services/move-validator":"move-validator","../state-machine/state-names":"state-names"}],isheduler:[function(e,t,o){"use strict";cc._RF.push(t,"4b5fbg4dg9HtoqNYl8ahu9r","isheduler"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"level-service":[function(e,t,o){"use strict";cc._RF.push(t,"4c6f85DOGhBYYE9SRYAf+e9","level-service"),Object.defineProperty(o,"__esModule",{value:!0}),o.LevelService=void 0;var n=function(){function e(e){this._config=e,this._currentLevelId=0,this._mapId=0}return e.prototype.getCurrentLevel=function(){return this._config.getLevel(this._currentLevelId)},e.prototype.getCurrentMapId=function(){return this._mapId},e.prototype.getLevel=function(e){return this._config.getLevel(e)},e.prototype.nextLevel=function(){this._currentLevelId++,this._config.getConditionNextMap(this._currentLevelId)&&this._mapId++},e.prototype.resetProgress=function(){this._currentLevelId=0,this._mapId=0},e.prototype.getScoreFormula=function(){return this._config.getScoreFormula()},e}();o.LevelService=n,cc._RF.pop()},{}],"load-scene-state":[function(e,t,o){"use strict";cc._RF.push(t,"204b6tODgBEBojVDblhM9oQ","load-scene-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.LoadSceneState=void 0;var i=function(){function e(e){this._gameFactory=e.gameFactory,this._stateMachine=e.stateMachine}return e.prototype.run=function(e){return n(this,void 0,void 0,function(){var t,o,i,c=this;return r(this,function(s){switch(s.label){case 0:return t=e.sceneName,o=e.stateName,[4,(i=this._gameFactory.createCurtain()).showCurtain()];case 1:return s.sent(),[4,cc.director.loadScene(t,function(){return n(c,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this._stateMachine.run(o)];case 1:return e.sent(),[4,i.hideCurtain()];case 2:return e.sent(),[2]}})})})];case 2:return s.sent(),[2]}})})},e.prototype.stop=function(){},e}();o.LoadSceneState=i,cc._RF.pop()},{}],"mechanic-controller":[function(e,t,o){"use strict";cc._RF.push(t,"27c3fTyvS9DDoHh15eZyjuX","mechanic-controller");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicController=void 0;var i=e("./basic-mechanic"),c=e("./booster-bomb-mechanic"),s=e("./teleport-booster-mechanic"),a=function(){function e(e,t,o,n,r){this._mechanics=[],this._activeMechanic=null,this.initMechanics(e,o,n,[new i.BasicMechanic(t,e),new c.BoosterBombMechanic(t,r,e),new s.TeleportBoosterMechanic(t,e)])}return e.prototype.initMechanics=function(e,t,o,n){this._mechanics=n,n.forEach(function(e){return e.init(t,o)});try{this.setActiveMechanic(this.getMechanicByType(i.BasicMechanic))}catch(r){throw r}},e.prototype.setActiveMechanic=function(e){cc.log("set active mechanic : ",e),this._activeMechanic=e},e.prototype.getActiveMechanic=function(){return this._activeMechanic},e.prototype.getMechanicByType=function(e){return this._mechanics.find(function(t){return t instanceof e})},e.prototype.onTileClick=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this._activeMechanic?(this.onClickTile&&this.onClickTile(e),[4,this._activeMechanic.onTileClick(e)]):[2];case 1:return!t.sent()||this._activeMechanic instanceof i.BasicMechanic||this.setActiveMechanic(this.getMechanicByType(i.BasicMechanic)),[2]}})})},e.prototype.removeListeners=function(){this.onClickTile=null},e.prototype.onTurnEnd=function(){for(var e=0,t=this._mechanics;e<t.length;e++){var o=t[e];o.onTurnEnd&&o.onTurnEnd()}},e}();o.MechanicController=a,cc._RF.pop()},{"./basic-mechanic":"basic-mechanic","./booster-bomb-mechanic":"booster-bomb-mechanic","./teleport-booster-mechanic":"teleport-booster-mechanic"}],"mechanic-event-system":[function(e,t,o){"use strict";cc._RF.push(t,"88fe2Io3/xLTKHYM5wKeP0i","mechanic-event-system"),Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicEventSystem=o.MechanicEventType=void 0,(o.MechanicEventType||(o.MechanicEventType={})).MECHANIC_USED="MECHANIC_USED";var n=function(){function e(){}return e.subscribe=function(e){this.observers.push(e)},e.unsubscribe=function(e){var t=this.observers.indexOf(e);-1!==t&&this.observers.splice(t,1)},e.dispatch=function(e){for(var t=0,o=this.observers;t<o.length;t++)o[t].onMechanicEvent(e)},e.observers=[],e}();o.MechanicEventSystem=n,cc._RF.pop()},{}],"mechanic-types":[function(e,t,o){"use strict";cc._RF.push(t,"a521206bMtESISMmd/D44Th","mechanic-types"),Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicType=void 0,function(e){e[e.BombBoster=0]="BombBoster",e[e.TeleportBoster=1]="TeleportBoster",e[e.Basic=2]="Basic"}(o.MechanicType||(o.MechanicType={})),cc._RF.pop()},{}],"menu-factory":[function(e,t,o){"use strict";cc._RF.push(t,"449c0a+tPRE2YGL3Xgkgd/M","menu-factory");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MenuFactory=void 0;var s=e("../../../menu/roadmap/roadmap"),a=function(e){function t(t){var o=e.call(this,t.assetProvider)||this,n=t.assetProvider,r=t.prefabsMenuConfig,i=t.levelService,c=t.persistentsPrefabsConfig;o._assetProvider=n,o._prefabsMenuConfig=r,o._levelService=i,o._persistentPrefabsConfig=c;var s=o._levelService.getCurrentMapId();return o._pathMap=o._prefabsMenuConfig.getRoadmapPrefabById(s),o}return r(t,e),t.prototype.loadAssets=function(){return i(this,void 0,void 0,function(){var e,t=this;return c(this,function(o){switch(o.label){case 0:return e=[this._persistentPrefabsConfig.curtainPrefab,this._pathMap],[4,this.handleAssets(e,function(e){return t._assetProvider.loadAsset(e)})];case 1:return o.sent(),[2]}})})},t.prototype.createRoadmap=function(){return this.instantiateOnCanvas(this._pathMap,s.Roadmap)},t.prototype.cleanUp=function(){return i(this,void 0,void 0,function(){var e=this;return c(this,function(t){switch(t.label){case 0:return[4,this.handleAssets([this._pathMap],function(t){return e._assetProvider.unloadAsset(t)})];case 1:return t.sent(),[2]}})})},t}(e("./abstract-factory").AbstractFactory);o.MenuFactory=a,cc._RF.pop()},{"../../../menu/roadmap/roadmap":"roadmap","./abstract-factory":"abstract-factory"}],"menu-state":[function(e,t,o){"use strict";cc._RF.push(t,"fb9f3xgJ9BPOKBkOXqGsZh3","menu-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.MenuState=void 0;var n=function(){function e(e){var t=e.stateMachine;this._stateMachine=t}return e.prototype.run=function(){},e.prototype.stop=function(){},e}();o.MenuState=n,cc._RF.pop()},{}],"move-validator":[function(e,t,o){"use strict";cc._RF.push(t,"7dd72tpylpLoJejIwrk8Ajo","move-validator"),Object.defineProperty(o,"__esModule",{value:!0}),o.MovePlayerValidator=void 0;var n=function(){function e(){}return e.prototype.hasPossibleMoves=function(e){for(var t=e.getTiles(),o=t.length,n=t[0].length,r=0;r<o;r++)for(var i=0;i<n;i++){var c=t[r][i];if(c)for(var s=0,a=[{x:r+1,y:i},{x:r,y:i+1},{x:r-1,y:i},{x:r,y:i-1}];s<a.length;s++){var l=a[s];if(this.isValidPosition(l.x,l.y,o,n)){var u=t[l.x][l.y];if(u&&u.tileType===c.tileType)return!0}}}return cc.log("No possible moves found"),!1},e.prototype.isValidPosition=function(e,t,o,n){return e>=0&&e<o&&t>=0&&t<n},e}();o.MovePlayerValidator=n,cc._RF.pop()},{}],"paralax-effect":[function(e,t,o){"use strict";cc._RF.push(t,"c8fb2u8XqtHNoxIN9KPjoE7","paralax-effect");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.ParallaxEffect=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layers=[],t.speedFactors=[],t.initialContentPosition=cc.Vec3.ZERO,t.initialLayersPositions=[],t}return r(t,e),t.prototype.onLoad=function(){0!==this.layers.length?this.layers.length===this.speedFactors.length?(this.initialContentPosition=this.node.position.clone(),this.initialLayersPositions=this.layers.map(function(e){return e.position.clone()})):cc.error("\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043b\u043e\u0451\u0432 \u0438 \u043c\u043d\u043e\u0436\u0438\u0442\u0435\u043b\u0435\u0439 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0442\u044c!"):cc.warn("No layers set for ParallaxEffect")},t.prototype.update=function(){for(var e=this.node.position.sub(this.initialContentPosition),t=0;t<this.layers.length;t++){var o=this.layers[t],n=this.speedFactors[t],r=this.initialLayersPositions[t],i=e.mul(n-1),c=r.add(i);o.setPosition(c)}},i([a({type:[cc.Node],tooltip:"\u0421\u043b\u043e\u0438 \u0434\u043b\u044f \u043f\u0430\u0440\u0430\u043b\u043b\u0430\u043a\u0441-\u044d\u0444\u0444\u0435\u043a\u0442\u0430 (\u043e\u0442 \u0437\u0430\u0434\u043d\u0435\u0433\u043e \u043a \u043f\u0435\u0440\u0435\u0434\u043d\u0435\u043c\u0443)"})],t.prototype,"layers",void 0),i([a({type:[cc.Float],tooltip:"\u041c\u043d\u043e\u0436\u0438\u0442\u0435\u043b\u0438 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043b\u043e\u044f (0.1-0.9 \u0434\u043b\u044f \u0444\u043e\u043d\u0430, 1.0 \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e)"})],t.prototype,"speedFactors",void 0),i([s],t)}(cc.Component);o.ParallaxEffect=l,cc._RF.pop()},{}],"particle-delay-controller":[function(e,t,o){"use strict";cc._RF.push(t,"fcfd6NDq+tJ66JLuvC6RJhr","particle-delay-controller");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.ParticleDelayController=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.particleSystem=[],t.delay=[],t}return r(t,e),t.prototype.start=function(){this.startParticlesWithDelays()},t.prototype.startParticlesWithDelays=function(){for(var e=this,t=function(t){var n=o.particleSystem[t],r=o.delay[t];n&&n.isValid&&void 0!==r?o.scheduleOnce(function(){e.startSingleParticle(n)},r):cc.log("Skipping particle "+t+": invalid configuration")},o=this,n=0;n<this.particleSystem.length;n++)t(n)},t.prototype.startSingleParticle=function(e){e&&e.isValid?(e.node.active=!0,e.resetSystem()):cc.log("Attempted to start an invalid particle system")},t.prototype.startAllParticlesNow=function(){for(var e=0;e<this.particleSystem.length;e++){var t=this.particleSystem[e];this.startSingleParticle(t)}},t.prototype.stopAllParticlesNow=function(){this.unscheduleAllCallbacks()},i([a([cc.ParticleSystem])],t.prototype,"particleSystem",void 0),i([a([cc.Float])],t.prototype,"delay",void 0),i([s],t)}(cc.Component);o.ParticleDelayController=l,cc._RF.pop()},{}],"progress-level-controller":[function(e,t,o){"use strict";cc._RF.push(t,"fa7ddEMiAZGEpPtoiAEqSb4","progress-level-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressLevelController=void 0;var n=function(){function e(e,t){this.progress=e,this.levels=t}return e.prototype.getWinScoreThreshold=function(){return this.levels.getCurrentLevel().winScoreThreshold},e.prototype.getMaxStep=function(){return this.levels.getCurrentLevel().maxSteps},e.prototype.getCurrentScore=function(){return this.progress.currentScore},e.prototype.getRemainingSteps=function(){return this.progress.remainingSteps},e.prototype.onWin=function(){this.levels.nextLevel(),this.progress.resetLevel()},e.prototype.onLose=function(){this.levels.resetProgress(),this.progress.resetLevel()},e.prototype.checkProgress=function(){this.getCurrentScore()>=this.getWinScoreThreshold()?(this.onWinEvent&&this.onWinEvent(),this.onWin()):this.getRemainingSteps()<=0&&(this.onLoseEvent&&this.onLoseEvent(),this.onLose())},e}();o.ProgressLevelController=n,cc._RF.pop()},{}],"progress-service":[function(e,t,o){"use strict";cc._RF.push(t,"8ce93CCCP5FypBbxvbk3bTi","progress-service"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressGameService=void 0;var n=function(){function e(e){this._levelService=e,this.currentScore=0,this.isGameOver=!1,this.resetLevel()}return e.prototype.getWinScoreThreshold=function(){return this._levelService.getCurrentLevel().winScoreThreshold},e.prototype.getMaxStep=function(){return this._levelService.getCurrentLevel().maxSteps},e.prototype.resetLevel=function(){var e=this._levelService.getCurrentLevel();this.remainingSteps=e.maxSteps,this.isGameOver=!1,this.currentScore=0},e.prototype.nextStep=function(e){e>1&&(this.currentScore+=this._levelService.getScoreFormula()(e)),this.remainingSteps--,this.checkGameOver()},e.prototype.checkGameOver=function(){return this.isGameOver=this.currentScore>=this._levelService.getCurrentLevel().winScoreThreshold||this.remainingSteps<=0},e}();o.ProgressGameService=n,cc._RF.pop()},{}],"result-level-controller":[function(e,t,o){"use strict";cc._RF.push(t,"03179QTKTBD65670nXGNtWo","result-level-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.ResultLevelController=void 0;var n=function(){function e(e,t){this._progressService=e,this._tableController=t}return e.prototype.clearLevel=function(){this._progressService.resetLevel(),this._tableController.resetTable()},e}();o.ResultLevelController=n,cc._RF.pop()},{}],"result-level-view":[function(e,t,o){"use strict";cc._RF.push(t,"760cce+6OpJCYRVVWDBrRbt","result-level-view");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},c=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var i=arguments[t],c=0,s=i.length;c<s;c++,r++)n[r]=i[c];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.ResultLevelView=void 0;var l=cc._decorator,u=l.ccclass,p=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resultLabel=null,t.restartButton=null,t.continueButton=null,t.fadeSprite=null,t.gameOverEffect=null,t.popupResult=null,t.emptyStars=[],t.stars=[],t._onClickRestart=null,t._onClickContinue=null,t}return r(t,e),t.prototype.onLoad=function(){var e=this;this._continuePromise=new Promise(function(t){e._onClickContinue=t}),this._restartPromise=new Promise(function(t){e._onClickRestart=t}),this.resultLabel.string="",this.popupResult.scale=0},t.prototype.win=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.showResult(this.continueButton,e,!0)];case 1:return[2,t.sent()]}})})},t.prototype.lose=function(e){return c(this,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.showResult(this.restartButton,e)];case 1:return[2,t.sent()]}})})},t.prototype.waitForClickRestart=function(){return c(this,void 0,Promise,function(){return s(this,function(){return[2,this._restartPromise]})})},t.prototype.waitForClickContinue=function(){return c(this,void 0,Promise,function(){return s(this,function(){return[2,this._continuePromise]})})},t.prototype.showResult=function(e,t,o){return void 0===o&&(o=!1),c(this,void 0,Promise,function(){return s(this,function(n){switch(n.label){case 0:return this.subscribeButtonEvents(),[4,this.showGameOver()];case 1:return n.sent(),this.showFade(!0),[4,this.showPopup()];case 2:return n.sent(),this.showMessage(t),[4,this.showEmptyStars()];case 3:return n.sent(),o?[4,this.showStars()]:[3,5];case 4:n.sent(),n.label=5;case 5:return[4,this.scheduleOnce(function(){e.node.active=!0},.5)];case 6:return n.sent(),[2]}})})},t.prototype.showEmptyStars=function(){return c(this,void 0,void 0,function(){var e,t,o,n;return s(this,function(r){switch(r.label){case 0:if(!this.emptyStars||0===this.emptyStars.length)return[2];for(this.emptyStars.forEach(function(e){e&&(e.scale=0,e.active=!0,e.opacity=0)}),e=[],t=function(t){var n=o.emptyStars[t];if(n){var r=new Promise(function(e){cc.tween(n).delay(.15*t).parallel(cc.tween().to(.3,{scale:1},{easing:"elasticOut"}),cc.tween().to(.2,{opacity:255},{easing:"fade"})).to(.1,{scale:1.1},{easing:"quadOut"}).to(.1,{scale:1},{easing:"quadIn"}).call(function(){return e()}).start()});e.push(r)}},o=this,n=0;n<this.emptyStars.length;n++)t(n);return[4,Promise.all(e)];case 1:return r.sent(),[2]}})})},t.prototype.showMessage=function(e){var t=this;if(this.resultLabel){for(var o="",n=[],r=function(r){var i=e[r],c=cc.callFunc(function(){o+=i,t.resultLabel.string=o}),s=cc.delayTime(.1*Math.random()+.05);n.push(c),n.push(s)},i=0;i<e.length;i++)r(i);cc.tween(this.resultLabel).delay(.3).then(cc.sequence(a(n))).start()}},t.prototype.showStars=function(){return c(this,void 0,void 0,function(){var e,t,o,n;return s(this,function(r){switch(r.label){case 0:if(!this.stars||0===this.stars.length)return[2];for(this.stars.forEach(function(e){e&&(e.scale=0,e.active=!0,e.opacity=0,e.angle=0)}),e=[],t=function(t){var n=o.stars[t];if(n){var r=new Promise(function(e){cc.tween(n).delay(.1*t).parallel(cc.tween().to(.6,{scale:1,x:0,y:0},{easing:"elasticOut"}),cc.tween().to(.3,{opacity:255},{easing:"fade"}),cc.tween().to(.4,{angle:360},{easing:"quadOut"})).to(.2,{scale:1.3},{easing:"backOut"}).to(.2,{scale:1},{easing:"backIn"}).to(.3,{angle:360},{easing:"quadInOut"}).call(function(){return e()}).start()});e.push(r)}},o=this,n=0;n<this.stars.length;n++)t(n);return[4,Promise.all(e)];case 1:return r.sent(),[2]}})})},t.prototype.showPopup=function(){return c(this,void 0,void 0,function(){var e=this;return s(this,function(t){switch(t.label){case 0:return this.popupResult?(this.popupResult.active=!0,this.popupResult.opacity=255,[4,new Promise(function(t){cc.tween(e.popupResult).to(.2,{scale:1.2},{easing:"backOut"}).to(.1,{scale:1},{easing:"backIn"}).delay(.3).to(.2,{scale:1.1},{easing:"quadOut"}).to(.1,{scale:1},{easing:"quadIn"}).call(function(){t()}).start()})]):[2];case 1:return t.sent(),[2]}})})},t.prototype.showGameOver=function(){return c(this,void 0,Promise,function(){var e=this;return s(this,function(t){switch(t.label){case 0:return this.gameOverEffect?(this.gameOverEffect.scale=0,this.gameOverEffect.active=!0,this.gameOverEffect.opacity=255,[4,new Promise(function(t){cc.tween(e.gameOverEffect).to(.3,{scale:1.2},{easing:"backOut"}).to(.2,{scale:1},{easing:"backIn"}).delay(1).to(.5,{opacity:0},{easing:"quadOut"}).call(function(){e.gameOverEffect.active=!1,t()}).start()})]):[2];case 1:return t.sent(),[2]}})})},t.prototype.clickRestart=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.handleGameAction(this.restartButton.node)];case 1:return e.sent(),this._onClickRestart(),[2]}})})},t.prototype.clickContinue=function(){return c(this,void 0,Promise,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.handleGameAction(this.continueButton.node)];case 1:return e.sent(),this._onClickContinue(),[2]}})})},t.prototype.handleGameAction=function(e){return c(this,void 0,Promise,function(){var t=this;return s(this,function(o){switch(o.label){case 0:return this.unsubscribeButtonEvents(),[4,new Promise(function(e){t.scheduleOnce(function(){e()},.5)})];case 1:return o.sent(),this.showFade(!1),this.resultLabel.node.active=!1,e.active=!1,[2]}})})},t.prototype.showFade=function(e){e?cc.tween(this.fadeSprite.node).to(.3,{opacity:200}).start():cc.tween(this.fadeSprite.node).to(.3,{opacity:0}).start()},t.prototype.subscribeButtonEvents=function(){this.restartButton.node.on(cc.Node.EventType.TOUCH_END,this.clickRestart,this),this.continueButton.node.on(cc.Node.EventType.TOUCH_END,this.clickContinue,this)},t.prototype.unsubscribeButtonEvents=function(){this.restartButton.node.off(cc.Node.EventType.TOUCH_END,this.clickRestart,this),this.continueButton.node.off(cc.Node.EventType.TOUCH_END,this.clickContinue,this)},t.prototype.destroyGo=function(){this.fadeSprite&&this.fadeSprite.node&&cc.Tween.stopAllByTarget(this.fadeSprite.node),this.destroy()},i([p(cc.Label)],t.prototype,"resultLabel",void 0),i([p(cc.Button)],t.prototype,"restartButton",void 0),i([p(cc.Button)],t.prototype,"continueButton",void 0),i([p(cc.Sprite)],t.prototype,"fadeSprite",void 0),i([p(cc.Node)],t.prototype,"gameOverEffect",void 0),i([p(cc.Node)],t.prototype,"popupResult",void 0),i([p(cc.Node)],t.prototype,"emptyStars",void 0),i([p(cc.Node)],t.prototype,"stars",void 0),i([u],t)}(cc.Component);o.ResultLevelView=h,cc._RF.pop()},{}],"result-state":[function(e,t,o){"use strict";cc._RF.push(t,"d25fei1aFhCIJt3n5/INyLI","result-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ResultState=void 0;var i=e("../state-machine/state-names"),c=function(){function e(e,t){this._stateMachine=e,this._gameFactory=t}return e.prototype.run=function(e){return n(this,void 0,Promise,function(){var t;return r(this,function(o){switch(o.label){case 0:return t=this._gameFactory.createUIResultView(),"win"!==e.result?[3,3]:[4,t.win(e.message)];case 1:return o.sent(),[4,t.waitForClickContinue()];case 2:return o.sent(),[3,6];case 3:return[4,t.lose(e.message)];case 4:return o.sent(),[4,t.waitForClickRestart()];case 5:o.sent(),o.label=6;case 6:return[4,this._stateMachine.run(i.StateNames.LoadSceneState,{sceneName:"menu",stateName:i.StateNames.CreateMenuState})];case 7:return o.sent(),[2]}})})},e.prototype.stop=function(){},e}();o.ResultState=c,cc._RF.pop()},{"../state-machine/state-names":"state-names"}],"roadmap-controller":[function(e,t,o){"use strict";cc._RF.push(t,"39753C+QO9JGJv7AxjG5bfa","roadmap-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.RoadmapController=void 0;var n=e("../../infrastructure/state-machine/state-names"),r=e("./scroll-calculater"),i=function(){function e(e){var t=this,o=e.roadmap,n=e.levelService,r=e.stateMachine;this._roadmap=o,this._levelService=n,this._stateMachine=r,o.onClickPlay=function(){return t.onClickPlayButton()},this.setRoadmapPointsInfo(),this.scrollToCurrentPoint()}return e.prototype.onClickPlayButton=function(){this._stateMachine.run(n.StateNames.LoadSceneState,{sceneName:"game",stateName:n.StateNames.CreateLevelContentState})},e.prototype.setRoadmapPointsInfo=function(){var e=this._roadmap.getRoadmapPoints();if(0!==e.length)for(var t=0;t<e.length;t++){var o=e[t];o&&o.showPointInfo(this._levelService.getCurrentLevel().id)}},e.prototype.scrollToCurrentPoint=function(){var e=this._levelService.getCurrentLevel().id,t=this._roadmap.getRoadmapPoints();if(0!==t.length){for(var o=null,n=0;n<t.length;n++){var i=t[n];if(i&&i.getCurrentLevelPoint(e)){o=i;break}}if(o){var c=this._roadmap.getContent(),s=this._roadmap.getScrollViewSize();if(c&&!s.equals(cc.Size.ZERO)){var a=r.calculateScrollPosition(o.node,c,s);this._roadmap.scrollToPosition(a,.5)}}}},e}();o.RoadmapController=i,cc._RF.pop()},{"../../infrastructure/state-machine/state-names":"state-names","./scroll-calculater":"scroll-calculater"}],"roadmap-point":[function(e,t,o){"use strict";cc._RF.push(t,"e6466hXUWxOpZ7dZZk3U5kO","roadmap-point");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.RoadmapPoint=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.level=0,t.spritePoint=null,t.levelLabel=null,t._correctionToLevelId=-1,t._currentAnimation=null,t._currentLevel=!1,t}return r(t,e),t.prototype.showPointInfo=function(e){var t=this.level+this._correctionToLevelId;t<e?this.spritePoint.node.color=cc.Color.GREEN:t===e?(this.spritePoint.node.color=cc.Color.YELLOW,this.startBounceAnimation()):t>e&&(this.spritePoint.node.color=cc.Color.GRAY),this.levelLabel.string="\u0443\u0440\u043e\u0432\u0435\u043d\u044c "+this.level.toString()},t.prototype.getCurrentLevelPoint=function(e){return this.level+this._correctionToLevelId===e?this:null},t.prototype.startBounceAnimation=function(){var e=cc.moveBy(.3,cc.v2(0,15)),t=cc.moveBy(.3,cc.v2(0,-15));e.easing(cc.easeOut(3)),t.easing(cc.easeIn(3));var o=cc.sequence(e,t,cc.delayTime(.4));this._currentAnimation=cc.repeatForever(o),this.node.runAction(this._currentAnimation)},i([a(cc.Integer)],t.prototype,"level",void 0),i([a(cc.Sprite)],t.prototype,"spritePoint",void 0),i([a(cc.Label)],t.prototype,"levelLabel",void 0),i([s],t)}(cc.Component);o.RoadmapPoint=l,cc._RF.pop()},{}],roadmap:[function(e,t,o){"use strict";cc._RF.push(t,"6c263njqqdCOZMYy8JbRRGp","roadmap");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.Roadmap=void 0;var c=e("./roadmap-point"),s=cc._decorator,a=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clouds=null,t.label=null,t.gameButton=null,t.scrollView=null,t.roadmapPoints=[],t}return r(t,e),t.prototype.onLoad=function(){this.gameButton.node.on(cc.Node.EventType.TOUCH_END,this.clickGameButton,this)},t.prototype.start=function(){this.startTweenButton(),this.startTweenClouds()},t.prototype.startTweenClouds=function(){this.clouds&&cc.tween(this.clouds.node).repeatForever(cc.tween().to(3,{x:this.clouds.node.x+20},{easing:"sineInOut"}).to(3,{x:this.clouds.node.x-20},{easing:"sineInOut"})).start()},t.prototype.startTweenButton=function(){cc.tween(this.gameButton.node).repeatForever(cc.tween().to(.4,{position:cc.v3(this.gameButton.node.x,this.gameButton.node.y+10)}).to(.4,{position:cc.v3(this.gameButton.node.x,this.gameButton.node.y)}).delay(.5)).start(),cc.tween(this.gameButton.node).repeatForever(cc.tween().to(.8,{scale:1.1}).to(.8,{scale:1})).start()},t.prototype.getRoadmapPoints=function(){return this.roadmapPoints},t.prototype.scrollToPosition=function(e,t){void 0===t&&(t=.5),this.scrollView&&this.scrollView.scrollToOffset(e,t,!0)},t.prototype.getScrollViewSize=function(){return this.scrollView.node.getContentSize()},t.prototype.getContent=function(){return this.scrollView.content},t.prototype.clickGameButton=function(){this.onClickPlay&&this.onClickPlay()},t.prototype.onDestroy=function(){var e,t;null===(t=null===(e=null==this?void 0:this.gameButton)||void 0===e?void 0:e.node)||void 0===t||t.off(cc.Node.EventType.TOUCH_END,this.clickGameButton,this)},i([l(cc.Sprite)],t.prototype,"clouds",void 0),i([l(cc.Label)],t.prototype,"label",void 0),i([l(cc.Button)],t.prototype,"gameButton",void 0),i([l(cc.ScrollView)],t.prototype,"scrollView",void 0),i([l(c.RoadmapPoint)],t.prototype,"roadmapPoints",void 0),i([a],t)}(cc.Component);o.Roadmap=u,cc._RF.pop()},{"./roadmap-point":"roadmap-point"}],"scroll-calculater":[function(e,t,o){"use strict";cc._RF.push(t,"59343GtyUxGl5GjkY3pfG5I","scroll-calculater"),Object.defineProperty(o,"__esModule",{value:!0}),o.calculateScrollPosition=void 0,o.calculateScrollPosition=function(e,t,o){var n=e.convertToWorldSpaceAR(cc.Vec2.ZERO),r=t.convertToWorldSpaceAR(cc.Vec2.ZERO),i=cc.v2(n.x-r.x,n.y-r.y),c=t.anchorX*t.width,s=i.x+c-o.width/2,a=Math.max(0,t.width-o.width),l=cc.misc.clampf(s,0,a);return cc.v2(l,0)},cc._RF.pop()},{}],serviceLocator:[function(e,t,o){"use strict";cc._RF.push(t,"88f5eQRvnVHrrLNqMv4pZz4","serviceLocator"),Object.defineProperty(o,"__esModule",{value:!0}),o.ServiceLocator=void 0;var n=function(){function e(){this._services=new Map}return e.container=function(){return null===this._instance&&(this._instance=new e),this._instance},e.prototype.registerSingle=function(e){cc.log("register service ",e);var t=e.constructor;this._services.set(t,e)},e.prototype.single=function(e){var t=e,o=this._services.get(t);if(!o)throw new Error("Service "+t.name+" not registered");return o},e._instance=null,e}();o.ServiceLocator=n,cc._RF.pop()},{}],"state-interfaces":[function(e,t,o){"use strict";cc._RF.push(t,"29c27EKHOZP4rR/N9FD/J+j","state-interfaces"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"state-names":[function(e,t,o){"use strict";cc._RF.push(t,"65c9bUSiwlCnKTH+x0fnB4w","state-names"),Object.defineProperty(o,"__esModule",{value:!0}),o.StateNames=void 0,function(e){e.Initialize="InitializeState",e.CreateMenuState="CreateMenuState",e.MenuState="MenuState",e.CreateLevelContentState="CreateLevelContentState",e.GameLoop="GameLoopState",e.ResultState="ResultState",e.LoadSceneState="LoadSceneState"}(o.StateNames||(o.StateNames={})),cc._RF.pop()},{}],"table-cell":[function(e,t,o){"use strict";cc._RF.push(t,"a81d6FR5B1L3J9CL7/mJKj9","table-cell"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableCell=void 0;var n=function(){function e(e,t,o,n){this._collumn=e,this._line=t,this._position=o,this._free=n}return e.prototype.getCollumn=function(){return this._collumn},e.prototype.getLine=function(){return this._line},e.prototype.getPosition=function(){return this._position},e.prototype.isFree=function(){return this._free},e.prototype.setFree=function(e){this._free=e},e}();o.TableCell=n,cc._RF.pop()},{}],"table-controller":[function(e,t,o){"use strict";cc._RF.push(t,"c9ddcY2gbtJkodXTJ05g77E","table-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableController=void 0;var n=function(){function e(e,t,o){this._tableView=e,this._model=t,this._vfxFactory=o,this._addTileOffsetPositionY=500,this.init()}return e.prototype.onSwap=function(e){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0430 \u044d\u0442\u043e \u0445\u0430\u043a")},e.prototype.beforeBurnGroupAction=function(e,t){this._vfxFactory.createVfxMessage(e.nodeTile,"+"+t+" \u043e\u0447\u043a\u043e\u0432!")},e.prototype.beforeBombAction=function(e,t){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0417\u0430\u0431\u0443\u0434\u044c, \u0447\u0442\u043e \u0441\u0435\u0439\u0447\u0430\u0441 \u0431\u044b\u043b\u043e +"+t)},e.prototype.init=function(){for(var e=this,t=this._model.getTiles(),o=this._model.getTableCells(),n=0;n<t.length;n++)for(var r=function(r){var c=t[n][r];if(c){c.addListener(function(){return e.onTileClick(c)});var s=o[n][r].getPosition();i._tableView.addTile(c,o[n][r],s)}},i=this,c=0;c<t[n].length;c++)r(c);this._model.onDropTileAction=function(t,o){return e.moveTileOnView(t,o)},this._model.onSwapTileAction=function(t,o){return e.swapTileOnView(t,o)},this._model.onAddTileAction=function(t,o){return e.addTileOnView(t,o)},this._model.onClearModelAction=function(t){return e.onClearTile(t)},this.onFalseBurnedAction=function(t){e._vfxFactory.createVfxMessage(t.nodeTile,"\u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u0430\u044f \u043f\u043b\u0438\u0442\u043a\u0430!"),e._tableView.showFalseBurnMessage(t)}},e.prototype.swapTileOnView=function(e,t){this._tableView.swapTile(e,t)},e.prototype.setMechanicController=function(e){this._mechanicController=e},e.prototype.moveTileOnView=function(e,t){this._tableView.moveTile(e,t)},e.prototype.addTileOnView=function(e,t){var o=this,n=t.getPosition(),r=new cc.Vec2(n.x,this._addTileOffsetPositionY+n.y);this._tableView.addTile(e,t,r),e.addListener(function(){return o.onTileClick(e)}),this.moveTileOnView(e,n)},e.prototype.onClearTile=function(e){e.removeListener(),this._tableView.removeTile(e)},e.prototype.onTileClick=function(e){this._mechanicController.onTileClick(e)},e.prototype.onBombAction=function(e){this._vfxFactory.createVfxBomb(e)},e.prototype.onDeselectTile=function(e){e.setActiveHightlight(!1)},e.prototype.onSelectTile=function(e){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0441\u043a\u0432\u043e\u0437\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438 \u0432\u0440\u0435\u043c\u044f"),e.setActiveHightlight(!0)},e.prototype.resetTable=function(){this._model.clearTable()},e.prototype.removeClickTileListeners=function(){for(var e=this._model.getTiles(),t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++){var n=e[t][o];n&&n.removeListener()}},e.prototype.onFalseBurned=function(){},e.prototype.onTurnEnd=function(){this.onEndTurnAction&&this.onEndTurnAction()},e}();o.TableController=n,cc._RF.pop()},{}],"table-model":[function(e,t,o){"use strict";cc._RF.push(t,"3b989ANl/JOebF4QGCb12uD","table-model"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableModel=void 0;var n=function(){function e(e,t){this._tableCells=e,this._tiles=t}return e.prototype.onSwapTile=function(e,t,o){void 0===o&&(o=!1),this.onSwapTileAction&&this.onSwapTileAction(e,t,o)},e.prototype.onAddTile=function(e,t){this.onAddTileAction&&this.onAddTileAction(e,t)},e.prototype.onMoveTile=function(e,t){this.onDropTileAction&&this.onDropTileAction(e,t)},e.prototype.getTableCells=function(){return this._tableCells},e.prototype.getTiles=function(){return this._tiles},e.prototype.getTile=function(e,t){return this.getTiles()[e][t]},e.prototype.setTile=function(e,t,o){this.getTiles()[e][t]=o},e.prototype.getCell=function(e,t){return this.getTableCells()[e][t]},e.prototype.getTilePosition=function(e){for(var t=this.getTiles(),o=0;o<t.length;o++)for(var n=0;n<t[o].length;n++)if(t[o][n]===e)return{col:o,row:n};return{col:-1,row:-1}},e.prototype.getTileCount=function(){var e,t=this.getTiles();return{columns:t.length,rows:(null===(e=t[0])||void 0===e?void 0:e.length)||0}},e.prototype.clearTable=function(){for(var e=this.getTiles(),t=this.getTableCells(),o=0;o<e.length;o++)for(var n=0;n<e[o].length;n++){var r=e[o][n];r&&(this.onClearModelAction(r),e[o][n]=null,t[o][n].setFree(!0))}},e}();o.TableModel=n,cc._RF.pop()},{}],"table-view":[function(e,t,o){"use strict";cc._RF.push(t,"4b047pohDRFQLwMp8UszKEN","table-view");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.TableView=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.content=null,t.nodeView=null,t}return r(t,e),t.prototype.onLoad=function(){this.nodeView=this.node},t.prototype.getContent=function(){return this.content},t.prototype.showFalseBurnMessage=function(e){var t=e.nodeTile,o=cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.runAction(o)},t.prototype.addTile=function(e,t,o){e.nodeTile.setParent(this.content),e.nodeTile.setPosition(o)},t.prototype.removeTile=function(e){cc.tween(e.sprite.node).parallel(cc.tween().to(.2,{scale:0},{easing:"backIn"}),cc.tween().to(.2,{angle:360},{easing:"quadIn"}),cc.tween().to(.2,{opacity:0},{easing:"quadIn"})).call(function(){e.destroyTile()}).start()},t.prototype.moveTile=function(e,t){var o=new cc.Vec3(t.x,t.y,0);cc.tween(e.nodeTile).to(.8,{position:o},{easing:"bounceOut"}).start()},t.prototype.swapTile=function(e,t){var o=new cc.Vec3(t.x,t.y,0),n=e.nodeTile.position,r=cc.v3((n.x+o.x)/2,(n.y+o.y)/2+30,0),i=e.nodeTile.zIndex;e.nodeTile.zIndex=9999,cc.tween(e.nodeTile).to(.3,{position:r,scale:1.5},{easing:"quadOut"}).to(.4,{position:o,scale:1},{easing:"quadIn"}).call(function(){e.nodeTile.zIndex=i}).start()},i([a(cc.Node)],t.prototype,"content",void 0),i([s],t)}(cc.Component);o.TableView=l,cc._RF.pop()},{}],"teleport-booster-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"e185985kqxHjKvbxwEKAmvv","teleport-booster-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.TeleportBoosterMechanic=void 0;var s=e("./abstract-mechanic"),a=e("./mechanic-types"),l=function(e){function t(t,o){var n=e.call(this,t,o)||this;return n.firstSelectedTile=null,n.mechanicType=a.MechanicType.TeleportBoster,n}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t,o;return c(this,function(){return this.firstSelectedTile&&this.firstSelectedTile.nodeTile?this.firstSelectedTile===e?(this._tableController.onDeselectTile(e),this.firstSelectedTile=null,[2,!1]):(t=this._tableModel.getTilePosition(this.firstSelectedTile),o=this._tableModel.getTilePosition(e),t&&o?(this.swapTiles(t,o),this.firstSelectedTile&&this.firstSelectedTile.nodeTile&&this._tableController.onDeselectTile(this.firstSelectedTile),this.firstSelectedTile=null,this._tableController.onSwap(e),[2,!0]):[2,!1]):(this.firstSelectedTile=e,this._tableController.onSelectTile(e),[2,!1])})})},t.prototype.swapTiles=function(e,t){var o=this._tableModel.getTile(e.col,e.row),n=this._tableModel.getTile(t.col,t.row);if(o&&n){this._tableModel.setTile(e.col,e.row,n),this._tableModel.setTile(t.col,t.row,o);var r=this._tableModel.getCell(e.col,e.row),i=this._tableModel.getCell(t.col,t.row);this._tableModel.onSwapTile(o,i.getPosition()),this._tableModel.onSwapTile(n,r.getPosition()),this.dispatchUseMechanicEvent(),this.onTurnEnd()}},t.prototype.onTurnEnd=function(){this.firstSelectedTile&&(this._tableController.onDeselectTile(this.firstSelectedTile),this.firstSelectedTile=null),this._tableController.onTurnEnd()},t}(s.AbstractMechanic);o.TeleportBoosterMechanic=l,cc._RF.pop()},{"./abstract-mechanic":"abstract-mechanic","./mechanic-types":"mechanic-types"}],"tile-factory":[function(e,t,o){"use strict";cc._RF.push(t,"7dd77XnjD9ERaHx0St8/Xq8","tile-factory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var n=e("../../../game-logic/tile"),r=function(){function e(e){this._assetProvider=e.assetProvider,this._tileModels=e.tileModelsConfig,this._prefabs=e.prefabsConfig}return e.prototype.createRandomTile=function(e){var t=this.getRandomTileModel();return this.createTile(t.tileType,t.sprite,e)},e.prototype.createTiles=function(e){for(var t=[],o=0;o<e.length;o++){t[o]=[];for(var n=0;n<e[o].length;n++){var r=e[o][n];if(r.isFree()){var i=this.getRandomTileModel(),c=this.createTile(i.tileType,i.sprite,r);r.setFree(!1),t[o][n]=c}else t[o][n]=null}}return t},e.prototype.getRandomTileModel=function(){var e=Math.random(),t=Math.floor(e*this._tileModels.length),o=this._tileModels[t],n=o.path,r=o.type,i=this._assetProvider.getAsset(n),c=new cc.SpriteFrame;return c.setTexture(i),{tileType:r,sprite:c}},e.prototype.createTile=function(e,t,o){try{var r=this._assetProvider.instantiateAsset(this._prefabs.tilePrefab).getComponent(n.Tile);return r.Init(e,t,o.getPosition()),r}catch(i){cc.error("Failed to create table:",i)}},e}();o.TileFactory=r,cc._RF.pop()},{"../../../game-logic/tile":"tile"}],"tile-type":[function(e,t,o){"use strict";cc._RF.push(t,"aea94/hd0xMD5AOW4/Aanlr","tile-type"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e.BLUE="blue",e.RED="red",e.GREEN="green",e.PURPLE="purple",e.YELLOW="yellow"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],tile:[function(e,t,o){"use strict";cc._RF.push(t,"9b4fe3dd5ZMh5e6wycNirgR","tile");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.Tile=void 0;var c=e("./tile-type"),s=cc._decorator,a=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tileType=c.TileType.BLUE,t.sprite=null,t.highlight=null,t.nodeTile=null,t}return r(t,e),t.prototype.Init=function(e,t,o){this.nodeTile=this.node,this.tileType=e,this.sprite.spriteFrame=t,this.node.setPosition(o)},t.prototype.onDestroy=function(){},t.prototype.addListener=function(e){this.touchHandler=e,this.sprite.node.on(cc.Node.EventType.TOUCH_END,this.touchHandler,this)},t.prototype.removeListener=function(){if(null===this.touchHandler||void 0===this.touchHandler)throw new Error("no touch handler");this.sprite.node.off(cc.Node.EventType.TOUCH_END,this.touchHandler,this)},t.prototype.setActiveHightlight=function(e){if(!this.highlight.node)throw new Error("no highlight node");this.highlight.node.active=e},t.prototype.destroyTile=function(){this.destroy()},i([l],t.prototype,"tileType",void 0),i([l(cc.Sprite)],t.prototype,"sprite",void 0),i([l(cc.Sprite)],t.prototype,"highlight",void 0),i([a],t)}(cc.Component);o.Tile=u,cc._RF.pop()},{"./tile-type":"tile-type"}],"ui-panel-controller":[function(e,t,o){"use strict";cc._RF.push(t,"8518arjEn9Ph5v3L4uBwp+/","ui-panel-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIPanelController=void 0;var n=e("../game-mechanic/booster-bomb-mechanic"),r=e("../game-mechanic/teleport-booster-mechanic"),i=function(){function e(e,t,o,n,r){this._progressController=e,this._progressService=t,this._uiPanelView=o,this._mechanicService=n,this.boosterService=r,this.start()}return e.prototype.start=function(){var e=this;this._uiPanelView.init(this._progressController.getWinScoreThreshold(),this._progressService.getMaxStep()),this.updateBoostersUI(),this.boosterService.onUpdate(function(){return e.updateBoostersUI()}),this._uiPanelView.onBombButtonClick=function(){return e.onClickBombBooster()},this._uiPanelView.onTeleportButtonClick=function(){return e.onClickTeleportBooster()},this._mechanicService.onClickTile=function(t){return e.onClickTile(t)}},e.prototype.removeBoosterListeners=function(){this._uiPanelView.removeListeners(),this._mechanicService.removeListeners()},e.prototype.updateBoostersUI=function(){var e=this.boosterService.getBombTrials(),t=this.boosterService.getTeleportTrials();this._uiPanelView.updateBombCount(e),this._uiPanelView.updateTeleportCount(t),this._uiPanelView.setBombButtonActive(e>0),this._uiPanelView.setTeleportButtonActive(t>0)},e.prototype.summonClickBomb=function(){this._uiPanelView.playBombSummonAnimation()},e.prototype.updateScore=function(){this._uiPanelView.updateScore(this._progressService.currentScore),this._uiPanelView.updateStep(this._progressService.remainingSteps)},e.prototype.onClickTeleportBooster=function(){if(!(this._mechanicService.getActiveMechanic()instanceof r.TeleportBoosterMechanic)&&this.boosterService.getTeleportTrials()>0){var e=this._mechanicService.getMechanicByType(r.TeleportBoosterMechanic);this._mechanicService.setActiveMechanic(e),this._uiPanelView.playTeleportActivationAnimation()}},e.prototype.onClickBombBooster=function(){this._mechanicService.getActiveMechanic()instanceof n.BoosterBombMechanic||this.boosterService.getBombTrials()>0&&(this.setActiveBomb(),this._uiPanelView.playBombActivationAnimation())},e.prototype.onClickTile=function(e){cc.log("add effect ui-panel-controller on clickTile",e)},e.prototype.setActiveBomb=function(){var e=this._mechanicService.getMechanicByType(n.BoosterBombMechanic);e?this._mechanicService.setActiveMechanic(e):cc.error("bombMechanic is undefined")},e}();o.UIPanelController=i,cc._RF.pop()},{"../game-mechanic/booster-bomb-mechanic":"booster-bomb-mechanic","../game-mechanic/teleport-booster-mechanic":"teleport-booster-mechanic"}],"ui-panel":[function(e,t,o){"use strict";cc._RF.push(t,"954b3K6+QRPn4GSO3PV9Dl7","ui-panel");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.UiPanelView=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepsLabel=null,t.scoreLabel=null,t.countBombLabel=null,t.bombButton=null,t.teleportButton=null,t.countTeleportLabel=null,t}return r(t,e),t.prototype.onLoad=function(){this.nodeView=this.node},t.prototype.init=function(e,t){this._winScore=e,this.stepsLabel.string=t.toString(),this.scoreLabel.string="0/"+e,this.bombButton.node.on(cc.Node.EventType.TOUCH_END,this.clickBomb,this),this.teleportButton.node.on(cc.Node.EventType.TOUCH_END,this.clickTeleport,this),this.setBombButtonActive(!0),this.setTeleportButtonActive(!0)},t.prototype.updateScore=function(e){this.scoreLabel.string=e+"/"+this._winScore,this.animateLabel(this.scoreLabel,.3)},t.prototype.updateStep=function(e){this.stepsLabel.string=e.toString(),this.animateLabel(this.stepsLabel,.5)},t.prototype.updateBombCount=function(e){this.countBombLabel.string=e.toString(),this.animateLabel(this.countBombLabel,.5)},t.prototype.setBombButtonActive=function(e){var t=this.bombButton.node;cc.Tween.stopAllByTarget(t),this.animateButton(t,e)},t.prototype.setTeleportButtonActive=function(e){var t=this.teleportButton.node;cc.Tween.stopAllByTarget(t),this.animateButton(t,e)},t.prototype.updateTeleportCount=function(e){this.countTeleportLabel.string=e.toString(),this.animateLabel(this.countTeleportLabel,.5)},t.prototype.playBombActivationAnimation=function(){this.playButtonActiveAnimation(this.bombButton.node)},t.prototype.playTeleportActivationAnimation=function(){this.playButtonActiveAnimation(this.teleportButton.node)},t.prototype.playBombSummonAnimation=function(){cc.Tween.stopAllByTarget(this.bombButton.node),cc.tween(this.bombButton.node).to(.3,{scale:1.25,color:cc.Color.RED},{easing:"sineOut"}).to(.4,{scale:1,color:cc.Color.WHITE},{easing:"sineIn"}).to(.1,{angle:-5}).to(.1,{angle:5}).to(.1,{angle:0}).repeat(10).start()},t.prototype.removeListeners=function(){this.onTeleportButtonClick=null,this.onBombButtonClick=null},t.prototype.playButtonActiveAnimation=function(e){cc.Tween.stopAllByTarget(e),e.scale=1,e.color=cc.Color.WHITE,cc.tween(e).to(.3,{scale:1.3,color:cc.Color.GREEN},{easing:"sineOut"}).to(.1,{scale:1.1}).to(.1,{scale:1.3}).to(.1,{scale:1.1}).to(.1,{scale:1.3}).to(.1,{scale:1.1}).call(function(){cc.tween(e).to(.3,{scale:1,color:cc.Color.WHITE},{easing:"sineOut"}).start()}).start()},t.prototype.clickTeleport=function(){this.onTeleportButtonClick&&this.onTeleportButtonClick()},t.prototype.clickBomb=function(){this.onBombButtonClick&&this.onBombButtonClick()},t.prototype.animateButton=function(e,t){cc.Tween.stopAllByTarget(this.node),t?(e.active=!0,e.opacity=255,e.scale=1,e.color=cc.Color.WHITE,cc.tween(e).to(.3,{scale:1.2},{easing:"sineOut"}).to(.3,{scale:1},{easing:"sineIn"}).start()):cc.tween(e).to(.25,{scale:1},{easing:"sineIn"}).call(function(){e.color=new cc.Color(180,180,180)}).start()},t.prototype.animateLabel=function(e,t){e&&e.node&&cc.tween(e.node).to(t,{scale:1.2},{easing:"sineOut"}).to(.1,{scale:1},{easing:"sineIn"}).start()},t.prototype.onDestroy=function(){var e,t;null===(t=null===(e=this.bombButton)||void 0===e?void 0:e.node)||void 0===t||t.off(cc.Node.EventType.TOUCH_END,this.clickBomb,this)},i([a(cc.Label)],t.prototype,"stepsLabel",void 0),i([a(cc.Label)],t.prototype,"scoreLabel",void 0),i([a(cc.Label)],t.prototype,"countBombLabel",void 0),i([a(cc.Button)],t.prototype,"bombButton",void 0),i([a(cc.Button)],t.prototype,"teleportButton",void 0),i([a(cc.Label)],t.prototype,"countTeleportLabel",void 0),i([s],t)}(cc.Component);o.UiPanelView=l,cc._RF.pop()},{}],"vfx-factory":[function(e,t,o){"use strict";cc._RF.push(t,"d9958bm4g9BTb5arAZns1Ql","vfx-factory"),Object.defineProperty(o,"__esModule",{value:!0}),o.VfxFactory=void 0;var n=function(){function e(e,t){this._assetProvider=e,this._prefabsConfig=t}return e.prototype.createVfxMessage=function(e,t){try{var o=cc.director.getScene().getChildByName("Canvas"),n=this._assetProvider.instantiateAsset(this._prefabsConfig.labelPrefab).getComponent(cc.Label),r=e.convertToWorldSpaceAR(cc.v2(0,0)),i=o.convertToNodeSpaceAR(r);return n.node.setParent(o),n.node.setPosition(i),n.string=t,n.node}catch(c){throw new Error("Failed to create vfx message: "+c)}},e.prototype.createVfxBomb=function(e){this.createBombEffect(e.sprite.node)},e.prototype.createBombEffect=function(e){try{var t=cc.director.getScene().getChildByName("Canvas"),o=this._assetProvider.instantiateAsset(this._prefabsConfig.bombEffectPrefab);if(!o)return cc.error("Failed to instantiate prefab"),null;var n=e.convertToWorldSpaceAR(cc.v2(0,0)),r=t.convertToNodeSpaceAR(n);return o.parent=t,o.setPosition(r),o.getComponent(cc.Component)||o}catch(i){return cc.error("Failed to create bomb effect:",i),null}},e}();o.VfxFactory=n,cc._RF.pop()},{}]},{},["config-types","configs","curtain","abstract-mechanic","basic-mechanic","booster-bomb-mechanic","booster-handler","game-mechanic","mechanic-controller","mechanic-event-system","mechanic-types","teleport-booster-mechanic","progress-level-controller","result-level-controller","table-cell","table-controller","table-model","table-view","tile-type","tile","fly-text","result-level-view","ui-panel-controller","ui-panel","entry-point","game","isheduler","particle-delay-controller","asset-provider","abstract-factory","game-factory","menu-factory","tile-factory","vfx-factory","level-service","progress-service","move-validator","serviceLocator","game-state-machine","game-states-register","state-interfaces","state-names","create-level-content-state","create-menu-state","game-loop-state","initialize-state","load-scene-state","menu-state","result-state","paralax-effect","roadmap-controller","roadmap-point","roadmap","scroll-calculater"]);