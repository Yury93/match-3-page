window.__require=function e(t,o,n){function r(c,s){if(!o[c]){if(!t[c]){var a=c.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var u=o[c]={exports:{}};t[c][0].call(u.exports,function(e){return r(t[c][1][e]||e)},u,u.exports,e,t,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({"abstract-machanic":[function(e,t,o){"use strict";cc._RF.push(t,"4087dTF1DBMPasvTIMFzaFf","abstract-machanic");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AbstractMechanic=void 0;var i=e("../../configs/configs"),c=e("./mechanic-event-system"),s=e("./mechanic-types"),a=function(){function e(e){this.tileFactory=e,this.mechanicType=s.MechanicType.Basic}return e.prototype.init=function(e,t){this.tableController=e,this.tableModel=t},e.prototype.onTurnEnd=function(){throw new Error("Method not implemented.")},e.prototype.onTileClick=function(){throw new Error("Method not implemented.")},e.prototype.dropTiles=function(){return n(this,void 0,void 0,function(){var e=this;return r(this,function(t){switch(t.label){case 0:return[4,setTimeout(function(){for(var t=e.tableModel.getTileCount(),o=t.columns,n=t.rows,r=0;r<o;r++)for(var i=n-1;i>=0;i--)if(!e.tableModel.getTile(r,i))for(var c=i-1;c>=0;c--){var s=e.tableModel.getTile(r,c);if(s){e.tableModel.setTile(r,i,s),e.tableModel.setTile(r,c,null),e.tableModel.onMoveTileAction(s,e.tableModel.getCell(r,i).getPosition()),e.tableModel.getCell(r,i).setFree(!1),e.tableModel.getCell(r,c).setFree(!0);break}}},i.CONSTANTS.dropTilesDelay)];case 1:return t.sent(),[2]}})})},e.prototype.fillEmpty=function(){return n(this,void 0,void 0,function(){var e=this;return r(this,function(t){switch(t.label){case 0:return[4,setTimeout(function(){for(var t=e.tableModel.getTileCount(),o=t.columns,n=t.rows,r=0;r<o;r++)for(var i=0;i<n;i++)if(!e.tableModel.getTile(r,i)){var c=e.tableModel.getCell(r,i),s=e.tileFactory.createRandomTile(c);e.tableModel.setTile(r,i,s),c.setFree(!1),e.tableModel.onAddTile(s,c)}},i.CONSTANTS.dropTilesDelay)];case 1:return t.sent(),[2]}})})},e.prototype.dispatchUseMechanicEvent=function(){c.MechanicEventSystem.dispatch({type:c.MechanicEventType.MECHANIC_USED,mechanic:this,mechanicType:this.mechanicType})},e}();o.AbstractMechanic=a,cc._RF.pop()},{"../../configs/configs":"configs","./mechanic-event-system":"mechanic-event-system","./mechanic-types":"mechanic-types"}],"asset-provider":[function(e,t,o){"use strict";cc._RF.push(t,"0e0c2jhz8xFuIYXqwXL54UA","asset-provider");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AssetProvider=void 0;var i=function(){function e(){this._assets={}}return e.prototype.loadAsset=function(e){return n(this,void 0,Promise,function(){var t=this;return r(this,function(){return this._assets[e]?[2,this._assets[e]]:[2,new Promise(function(o,n){cc.resources.load(e,function(r,i){if(r)return console.error("Failed to load asset: "+e,r),void n(r);t._assets[e]=i,o(i)})})]})})},e.prototype.getAsset=function(e){return this._assets[e]},e.prototype.instantiateAsset=function(e){return this._assets[e]?cc.instantiate(this._assets[e]):(console.error("Asset not found: "+e),null)},e.prototype.unloadAsset=function(e){this._assets[e]&&(console.log("Unloading asset: "+e),cc.resources.release(this._assets[e]),delete this._assets[e])},e}();o.AssetProvider=i,cc._RF.pop()},{}],"basic-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"b7740EWJ5tK7pmA/ZOz0Zh0","basic-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BasicMechanic=void 0;var s=e("../../configs/configs"),a=e("./abstract-machanic"),l=e("./mechanic-types"),u=function(e){function t(t){var o=e.call(this,t)||this;return o.mechanicType=l.MechanicType.Basic,o}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t;return c(this,function(o){switch(o.label){case 0:return(t=this.findConnectedTiles(e)).length<s.CONSTANTS.minGroupForBurn?(this.tableController.onFalseBurned(e),[2,!1]):(this.tableController.beforeBurnGroupAction(e,t.length),this.burnTiles(t),this.tableController.afterBurnGroupAction(e,t),[4,this.dropTiles()]);case 1:return o.sent(),[4,this.fillEmpty()];case 2:return o.sent(),this.tableController.onBurnAction&&this.tableController.onBurnAction(t.length),this.dispatchUseMechanicEvent(),[2,!0]}})})},t.prototype.onTurnEnd=function(){},t.prototype.findConnectedTiles=function(e){if(!e||!this.tableController)return[];console.log("startTile: ",e,"/tileSprite "+e.sprite+" / tile node: "+e.nodeTile);for(var t=this.tableModel.getTileCount(),o=new Set,n=[e],r=e.tileType,i=[{col:-1,row:0},{col:1,row:0},{col:0,row:-1},{col:0,row:1}];n.length>0;){var c=n.pop();if(!o.has(c)){o.add(c);var s=this.tableModel.getTilePosition(c);if(s)for(var a=0,l=i;a<l.length;a++){var u=l[a],p=s.col+u.col,h=s.row+u.row;if(!(p<0||h<0||p>=t.columns||h>=t.rows)){var f=this.tableModel.getTile(p,h);f&&!o.has(f)&&f.tileType===r&&n.push(f)}}}}return Array.from(o)},t.prototype.burnTiles=function(e){var t=this;e.forEach(function(e){var o=t.tableModel.getTilePosition(e),n=o.col,r=o.row;n>=0&&r>=0&&(t.tableController.onClearTile(e),t.tableModel.setTile(n,r,null),t.tableModel.getCell(n,r).setFree(!0))})},t}(a.AbstractMechanic);o.BasicMechanic=u,cc._RF.pop()},{"../../configs/configs":"configs","./abstract-machanic":"abstract-machanic","./mechanic-types":"mechanic-types"}],"booster-bomb-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"88fb2FhSS5Hi5ZpYpuptDU+","booster-bomb-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterBombMechanic=void 0;var s=e("../../configs/configs"),a=e("./abstract-machanic"),l=e("./mechanic-types"),u=function(e){function t(t){var o=e.call(this,t)||this;return o.RADIUS=s.CONSTANTS.boosterBombR,o.mechanicType=l.MechanicType.BombBoster,o}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t,o,n,r,i,s,a,l,u,p,h,f,d=this;return c(this,function(c){switch(c.label){case 0:if(this.tableController.onBombAction(e),t=this.tableModel.getTilePosition(e),o=t.col,n=t.row,o<0||n<0)return[2,!1];for(r=this.tableModel.getTileCount(),i=r.columns,s=r.rows,a=[],l=-this.RADIUS;l<=this.RADIUS;l++)for(u=-this.RADIUS;u<=this.RADIUS;u++)h=n+u,(p=o+l)>=0&&p<i&&h>=0&&h<s&&(f=this.tableModel.getTile(p,h))&&a.push(f);return 0===a.length?[2,!1]:(this.tableController.beforeBombAction(e,a.length),a.forEach(function(e){var t=d.tableModel.getTilePosition(e);d.tableController.onClearTile(e),d.tableModel.setTile(t.col,t.row,null),d.tableModel.getCell(t.col,t.row).setFree(!0)}),[4,this.dropTiles()]);case 1:return c.sent(),[4,this.fillEmpty()];case 2:return c.sent(),this.tableController.onBurnAction&&this.tableController.onBurnAction(a.length),this.dispatchUseMechanicEvent(),this.onTurnEnd(),[2,!0]}})})},t.prototype.onTurnEnd=function(){this.tableController.onTurnEnd()},t}(a.AbstractMechanic);o.BoosterBombMechanic=u,cc._RF.pop()},{"../../configs/configs":"configs","./abstract-machanic":"abstract-machanic","./mechanic-types":"mechanic-types"}],"booster-handler":[function(e,t,o){"use strict";cc._RF.push(t,"26db8bMyIRE7q9TmY+bfmKV","booster-handler"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterHandler=void 0;var n=e("./mechanic-event-system"),r=e("./mechanic-types"),i=function(){function e(e,t){this.updateCallbacks=[],this._bombTrials=e,this._teleportTrials=t,n.MechanicEventSystem.subscribe(this)}return e.prototype.onMechanicEvent=function(e){e.type===n.MechanicEventType.MECHANIC_USED&&(e.mechanicType===r.MechanicType.BombBoster?this.consumeBomb():e.mechanicType===r.MechanicType.TeleportBoster&&this.consumeTeleport())},e.prototype.consumeBomb=function(){this._bombTrials>0&&(this._bombTrials--,this.notifyUpdate())},e.prototype.consumeTeleport=function(){this._teleportTrials>0&&(this._teleportTrials--,this.notifyUpdate())},e.prototype.onUpdate=function(e){this.updateCallbacks.push(e)},e.prototype.notifyUpdate=function(){this.updateCallbacks.forEach(function(e){return e()})},e.prototype.getBombTrials=function(){return this._bombTrials},e.prototype.getTeleportTrials=function(){return this._teleportTrials},e.prototype.cleanListeners=function(){n.MechanicEventSystem.unsubscribe(this),this.updateCallbacks=[]},e}();o.BoosterHandler=i,cc._RF.pop()},{"./mechanic-event-system":"mechanic-event-system","./mechanic-types":"mechanic-types"}],configs:[function(e,t,o){"use strict";cc._RF.push(t,"cc9b28JaFxFzoHL/6aJzNPq","configs"),Object.defineProperty(o,"__esModule",{value:!0}),o.TILE_MODELS=o.PREFABS=o.GAME_CONFIG=o.CONSTANTS=o.TABLE=void 0;var n=e("../logic/tile-type");o.TABLE=[{column:9,lines:9,grid:95},{column:6,lines:6,grid:95}];var r=[{id:0,maxSteps:15,winScoreThreshold:50},{id:1,maxSteps:12,winScoreThreshold:40},{id:2,maxSteps:10,winScoreThreshold:45},{id:3,maxSteps:9,winScoreThreshold:50},{id:4,maxSteps:8,winScoreThreshold:55},{id:5,maxSteps:7,winScoreThreshold:60},{id:6,maxSteps:7,winScoreThreshold:65},{id:7,maxSteps:8,winScoreThreshold:70},{id:8,maxSteps:8,winScoreThreshold:75},{id:9,maxSteps:9,winScoreThreshold:80},{id:10,maxSteps:9,winScoreThreshold:85},{id:11,maxSteps:10,winScoreThreshold:90},{id:12,maxSteps:10,winScoreThreshold:95},{id:13,maxSteps:11,winScoreThreshold:100},{id:14,maxSteps:11,winScoreThreshold:105},{id:15,maxSteps:12,winScoreThreshold:110},{id:16,maxSteps:12,winScoreThreshold:115},{id:17,maxSteps:13,winScoreThreshold:120},{id:18,maxSteps:13,winScoreThreshold:125},{id:19,maxSteps:14,winScoreThreshold:130}];o.CONSTANTS={boosterBombR:1,scoreFormulaIndex:1,bombTrials:3,teleportTrials:3,dropTilesDelay:400,minGroupForBurn:2};var i=[{formula:function(e){return e*e*5}},{formula:function(e){return e}}],c=function(){function e(){}return e.prototype.getScoreFormula=function(){return i[o.CONSTANTS.scoreFormulaIndex].formula},e.prototype.getLevel=function(e){return r.find(function(t){return t.id===e})||(console.error("Level with id "+e+" not found return 0 level"),r[0])},e}();o.GAME_CONFIG=new c,o.PREFABS={tablePrefab:"table/Table",UIPanelPrefab:"table/UI",BombEffectPrefab:"table/ExplosionEffect",tilePrefab:"tiles/TilePrefab",curtainPrefab:"curtain/Curtain",LabelPrefab:"table/label"},o.TILE_MODELS=[{path:"tiles/block_blue",type:n.TileType.BLUE},{path:"tiles/block_green",type:n.TileType.GREEN},{path:"tiles/block_purpure",type:n.TileType.PURPLE},{path:"tiles/block_red",type:n.TileType.RED},{path:"tiles/block_yellow",type:n.TileType.YELLOW}],cc._RF.pop()},{"../logic/tile-type":"tile-type"}],"create-content-state":[function(e,t,o){"use strict";cc._RF.push(t,"1697280MopCpYIN+QlXWY/d","create-content-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.CreateContentState=void 0;var i=e("../state-machine/state-names"),c=e("../../logic/game-mechanic/mechanic-controller"),s=e("../../ui/ui-panel-controller"),a=e("../../configs/configs"),l=e("../../logic/game-mechanic/booster-handler"),u=e("../../logic/progress-controller"),p=function(){function e(e,t,o,n,r,i){this._stateMachine=e,this._gameFactory=t,this._tilesFactory=o,this._vfxFactory=n,this._progressService=r,this._levelService=i,this._tableView=null,this._uiPanelView=null,this._isLoadAssets=!1}return e.prototype.run=function(){return n(this,void 0,Promise,function(){return r(this,function(e){switch(e.label){case 0:return console.log("run create content state"),this._isLoadAssets?[3,2]:[4,this._gameFactory.loadAssets()];case 1:e.sent(),this._isLoadAssets=!0,e.label=2;case 2:return this.destroyContent(),this.createContent(),[2]}})})},e.prototype.destroyContent=function(){this._tableView&&(this._tableView.nodeView.destroy(),this._tableView=null),this._uiPanelView&&(this._uiPanelView.nodeView.destroy(),this._uiPanelView=null)},e.prototype.createContent=function(){this.createViews();var e=this.createTableCells(),t=this.createTiles(e),o=this.createTableModel(e,t),n=this.createTableController(o),r=this.createMechanicController(n,o);n.setMechanicController(r);var i=this.createBoosterHandler(),c=this.createProgressController(),s=this.createUIPanelController(r,i,c);this.startGameLoopState(o,n,i,c,s)},e.prototype.createViews=function(){this._tableView=this._gameFactory.createTableView(),this._uiPanelView=this._gameFactory.createUiPanelView()},e.prototype.createTableCells=function(){var e=this._tableView.getContent();return this._gameFactory.createTableCells(e)},e.prototype.createTiles=function(e){return this._tilesFactory.createTiles(e)},e.prototype.createTableModel=function(e,t){return this._gameFactory.createTableModel(e,t)},e.prototype.createTableController=function(e){return this._gameFactory.createTableController(this._tableView,e,this._vfxFactory)},e.prototype.createMechanicController=function(e,t){return new c.MechanicController(this._tilesFactory,e,t)},e.prototype.createBoosterHandler=function(){return new l.BoosterHandler(a.CONSTANTS.bombTrials,a.CONSTANTS.teleportTrials)},e.prototype.createProgressController=function(){return new u.ProgressController(this._progressService,this._levelService)},e.prototype.createUIPanelController=function(e,t,o){return new s.UIPanelController(o,this._progressService,this._uiPanelView,e,t)},e.prototype.startGameLoopState=function(e,t,o,n,r){this._stateMachine.run(i.StateNames.GameLoop,{tableModel:e,tableController:t,uiPanelView:this._uiPanelView,uiPanelController:r,boosterHandler:o,progressController:n})},e.prototype.stop=function(){console.log("stop create content state")},e}();o.CreateContentState=p,cc._RF.pop()},{"../../configs/configs":"configs","../../logic/game-mechanic/booster-handler":"booster-handler","../../logic/game-mechanic/mechanic-controller":"mechanic-controller","../../logic/progress-controller":"progress-controller","../../ui/ui-panel-controller":"ui-panel-controller","../state-machine/state-names":"state-names"}],curtain:[function(e,t,o){"use strict";cc._RF.push(t,"8309dgtnxtJqLUdtZYjvtY0","curtain");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resultLabel=null,t.restartButton=null,t.continueButton=null,t.fadeSprite=null,t.curtainSprite=null,t._startPosCurtain=null,t}return r(t,e),t.prototype.win=function(e){this.showResult(this.continueButton,e)},t.prototype.lose=function(e){this.showResult(this.restartButton,e)},t.prototype.showResult=function(e,t){var o=this;this.subscribeButtonEvents(),this._startPosCurtain=this.curtainSprite.node.position,this.resultLabel.string="",this.showFade(!0),this.showCurtain(function(){e.node.active=!0,o.resultLabel.string=t}).start()},t.prototype.clickRestart=function(){this.handleGameAction(this.restartButton.node,this.onRestart)},t.prototype.clickContinue=function(){this.handleGameAction(this.continueButton.node,this.onContinue)},t.prototype.handleGameAction=function(e,t){var o=this;this.unsubscribeButtonEvents(),this.showCurtain(function(){o.showFade(!1),o.resultLabel.node.active=!1,e.active=!1}).call(function(){o.node.destroy(),t&&t()}).start()},t.prototype.showFade=function(e){e?cc.tween(this.fadeSprite.node).to(.5,{opacity:170}).start():cc.tween(this.fadeSprite.node).to(.5,{opacity:0}).start()},t.prototype.showCurtain=function(e){return cc.Tween.stopAllByTarget(this.curtainSprite.node),cc.tween(this.curtainSprite.node).to(.3,{x:0},{easing:"quadOut"}).call(function(){e&&e()}).delay(1).to(.3,{x:this._startPosCurtain.x},{easing:"quadOut"})},t.prototype.subscribeButtonEvents=function(){this.restartButton.node.on(cc.Node.EventType.TOUCH_END,this.clickRestart,this),this.continueButton.node.on(cc.Node.EventType.TOUCH_END,this.clickContinue,this)},t.prototype.unsubscribeButtonEvents=function(){this.restartButton.node.off(cc.Node.EventType.TOUCH_END,this.clickRestart,this),this.continueButton.node.off(cc.Node.EventType.TOUCH_END,this.clickContinue,this)},t.prototype.onDestroy=function(){this.curtainSprite&&this.curtainSprite.node&&cc.Tween.stopAllByTarget(this.curtainSprite.node),this.fadeSprite&&this.fadeSprite.node&&cc.Tween.stopAllByTarget(this.fadeSprite.node)},i([a(cc.Label)],t.prototype,"resultLabel",void 0),i([a(cc.Button)],t.prototype,"restartButton",void 0),i([a(cc.Button)],t.prototype,"continueButton",void 0),i([a(cc.Sprite)],t.prototype,"fadeSprite",void 0),i([a(cc.Sprite)],t.prototype,"curtainSprite",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],"entry-point":[function(e,t,o){"use strict";cc._RF.push(t,"a9aa5EFkiRHk7gsuM2EnD8q","entry-point");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=e("./game"),s=e("./services/serviceLocator"),a=cc._decorator.ccclass,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){console.log("start create game"),this._game=new c.Game(s.ServiceLocator.Container())},i([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./game":"game","./services/serviceLocator":"serviceLocator"}],"fly-text":[function(e,t,o){"use strict";cc._RF.push(t,"db7c7KAmCVL4LgFfSdV1WeM","fly-text");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.moveDistance=150,t.duration=.4,t.easingPower=1.8,t}return r(t,e),t.prototype.start=function(){var e=this,t=this.node.position.clone(),o=cc.v3(t.x,t.y+this.moveDistance,t.z);this.node.scale=.7,this.node.opacity=180,cc.tween(this.node).to(.15,{scale:1,opacity:255},{easing:"backOut"}).to(this.duration,{position:o},{easing:"sineOut",onUpdate:function(t,o){e.node.opacity=255*(1-Math.pow(o,e.easingPower))}}).call(function(){return e.node.destroy()}).start()},i([a(cc.Label)],t.prototype,"label",void 0),i([a({tooltip:"\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u0432 \u043f\u0438\u043a\u0441\u0435\u043b\u044f\u0445"})],t.prototype,"moveDistance",void 0),i([a({tooltip:"\u041e\u0431\u0449\u0430\u044f \u0434\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0430\u043d\u0438\u043c\u0430\u0446\u0438\u0438 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445",min:.1})],t.prototype,"duration",void 0),i([a({tooltip:"\u0418\u043d\u0442\u0435\u043d\u0441\u0438\u0432\u043d\u043e\u0441\u0442\u044c \u0437\u0430\u043c\u0435\u0434\u043b\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u043d\u0446\u0435",range:[0,10],step:.1})],t.prototype,"easingPower",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],"game-factory":[function(e,t,o){"use strict";cc._RF.push(t,"a22c79dktBITo5Qf/ubjskH","game-factory");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameFactory=void 0;var i=e("../../../configs/configs"),c=e("../../../logic/table-cell"),s=e("../../../logic/table/table-view"),a=e("../../../logic/table/table-model"),l=e("../../../curtain/curtain"),u=e("../../../logic/table/table-controller"),p=e("../../../ui/ui-panel"),h=function(){function e(e){this._assetProvider=e}return e.prototype.loadAssets=function(){return n(this,void 0,void 0,function(){var e=this;return r(this,function(t){switch(t.label){case 0:return[4,this._assetProvider.loadAsset(i.PREFABS.curtainPrefab)];case 1:return t.sent(),[4,this._assetProvider.loadAsset(i.PREFABS.tablePrefab)];case 2:return t.sent(),[4,this._assetProvider.loadAsset(i.PREFABS.tilePrefab)];case 3:return t.sent(),[4,this._assetProvider.loadAsset(i.PREFABS.UIPanelPrefab)];case 4:return t.sent(),[4,this._assetProvider.loadAsset(i.PREFABS.BombEffectPrefab)];case 5:return t.sent(),[4,this._assetProvider.loadAsset(i.PREFABS.LabelPrefab)];case 6:return t.sent(),[4,Promise.all(i.TILE_MODELS.map(function(t){return e._assetProvider.loadAsset(t.path)}))];case 7:return t.sent(),[2]}})})},e.prototype.createTableView=function(){try{return this.instantiateOnCanvas(i.PREFABS.tablePrefab,s.default)}catch(e){console.error("Failed to create table:",e)}},e.prototype.createUiPanelView=function(){try{return this.instantiateOnCanvas(i.PREFABS.UIPanelPrefab,p.UiPanelView)}catch(e){console.error("Failed to create UI panel:",e)}},e.prototype.createCurtain=function(){try{var e=cc.director.getScene().getChildByName("Canvas"),t=this._assetProvider.instantiateAsset(i.PREFABS.curtainPrefab).getComponent(l.default);return t.node.setParent(e),t.node.setPosition(0,0),t}catch(o){console.error("Failed to create curtain:",o)}},e.prototype.createTableController=function(e,t,o){return new u.TableController(e,t,o)},e.prototype.createTableModel=function(e,t){return new a.TableModel(e,t)},e.prototype.createTableCells=function(){for(var e=[],t=Math.floor(Math.random()*i.TABLE.length),o=i.TABLE[t],n=o.column,r=o.lines,s=o.grid,a=o.grid,l=-(n-1)*s/2,u=(r-1)*a/2,p=0;p<n;p++){e[p]=[];for(var h=0;h<r;h++){var f=new cc.Vec2(l+p*s,u-h*a),d=new c.TableCell(p,h,f,!0);e[p][h]=d}}return e},e.prototype.instantiateOnCanvas=function(e,t){var o=cc.director.getScene().getChildByName("Canvas"),n=this._assetProvider.instantiateAsset(e).getComponent(t);return n.node.setParent(o),n.node.setPosition(0,0),n},e}();o.GameFactory=h,cc._RF.pop()},{"../../../configs/configs":"configs","../../../curtain/curtain":"curtain","../../../logic/table-cell":"table-cell","../../../logic/table/table-controller":"table-controller","../../../logic/table/table-model":"table-model","../../../logic/table/table-view":"table-view","../../../ui/ui-panel":"ui-panel"}],"game-loop-handler":[function(e,t,o){"use strict";cc._RF.push(t,"250b8ergttFML6OTbloZmkS","game-loop-handler"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoopHandler=void 0;var n=e("../infrastructure/state-machine/state-names"),r=function(){function e(){this._isResultShown=!1}return e.prototype.init=function(e,t,o,n){var r=this;this._gameLoopPayload=o,this._movePlayerValidator=n,this._stateMachine=e,this._progressService=t,this._gameEventCoordinator=new i(this._gameLoopPayload.tableController,function(e){return r.handleBurnAction(e)},function(){return r.handleEndTurnAction()},function(e){return r.handleFalseBurned(e)}),this._gameEndHandler=new c(this._stateMachine,this._gameLoopPayload.tableController,this._gameLoopPayload.boosterHandler,this._gameLoopPayload.uiPanelController,this._gameEventCoordinator),this.setupProgressEvents(),this.tryResolveMoves()},e.prototype.setupProgressEvents=function(){var e=this;this._gameLoopPayload.progressController.onWinEvent=function(){return e._gameEndHandler.handleGameEnd("win","\u0423\u0441\u043f\u0435\u0445!")},this._gameLoopPayload.progressController.onLoseEvent=function(){return e._gameEndHandler.handleGameEnd("lose","\u0417\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c\n \u0448\u0430\u0433\u0438...")}},e.prototype.tryResolveMoves=function(){this._isResultShown||this.hasBoosterTrials()||this.resolveImpossibleMoves()},e.prototype.handleBurnAction=function(e){this._progressService.nextStep(e),this._gameLoopPayload.uiPanelController.updateScore(),this._gameLoopPayload.progressController.checkProgress(),this.tryResolveMoves()},e.prototype.handleEndTurnAction=function(){this.tryResolveMoves()},e.prototype.handleFalseBurned=function(e){this._gameLoopPayload.boosterHandler.getBombTrials()>0&&this._gameLoopPayload.uiPanelController.summonClickBomb(),this._isResultShown||this.hasBoosterTrials()||this._gameLoopPayload.progressController.checkProgress(),this._gameLoopPayload.tableController.onFalseBurnedAction(e),this.tryResolveMoves()},e.prototype.hasBoosterTrials=function(){return this._gameLoopPayload.boosterHandler.getBombTrials()>0||this._gameLoopPayload.boosterHandler.getTeleportTrials()>0},e.prototype.resolveImpossibleMoves=function(){this._movePlayerValidator.hasPossibleMoves(this._gameLoopPayload.tableModel)||this._gameEndHandler.handleGameEnd("lose","\u041d\u0435\u0442\n \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432...")},e}();o.GameLoopHandler=r;var i=function(){function e(e,t,o,n){this._tableController=e,this.onBurnHandler=t,this.onEndTurnHandler=o,this.onFalseBurnedHandler=n,this.setupEventListeners()}return e.prototype.removeEventListeners=function(){this._tableController.onBurnAction=null,this._tableController.onEndTurnAction=null,this._tableController.onFalseBurned=null},e.prototype.setupEventListeners=function(){this._tableController.onBurnAction=this.onBurnHandler,this._tableController.onEndTurnAction=this.onEndTurnHandler,this._tableController.onFalseBurned=this.onFalseBurnedHandler},e}(),c=function(){function e(e,t,o,n,r){this._stateMachine=e,this._tableController=t,this._boosterHandler=o,this._uiPanelController=n,this._gameEventCoordinator=r}return e.prototype.handleGameEnd=function(e,t){this.cleanListeners(),this._gameEventCoordinator.removeEventListeners(),this._stateMachine.run(n.StateNames.ResultState,{result:e,message:t,tableController:this._tableController})},e.prototype.cleanListeners=function(){this._boosterHandler.cleanListeners(),this._tableController.removeClickTileListeners(),this._uiPanelController.removeClickBoosterListeners()},e}();cc._RF.pop()},{"../infrastructure/state-machine/state-names":"state-names"}],"game-loop-state":[function(e,t,o){"use strict";cc._RF.push(t,"851aeQvhJ1KmZWYl006WD2h","game-loop-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameLoopState=void 0;var n=e("../../logic/game-loop-handler"),r=function(){function e(e,t,o){this._stateMachine=e,this._progressService=t,this._movePlayerValidator=o}return e.prototype.run=function(e){this._gameLoopHandler=new n.GameLoopHandler,this._gameLoopHandler.init(this._stateMachine,this._progressService,e,this._movePlayerValidator)},e.prototype.stop=function(){},e}();o.GameLoopState=r,cc._RF.pop()},{"../../logic/game-loop-handler":"game-loop-handler"}],"game-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"665bafOwBlEUZdBQC7YO+W7","game-mechanic"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"game-state-machine":[function(e,t,o){"use strict";cc._RF.push(t,"336a1fdwvFLYaOGZ3QrUEMe","game-state-machine"),Object.defineProperty(o,"__esModule",{value:!0}),o.StateMachine=void 0;var n=e("../states/create-content-state"),r=e("../services/gameFactory/game-factory"),i=e("../states/game-loop-state"),c=e("../states/initialize-state"),s=e("../services/gameFactory/tile-factory"),a=e("../services/gameFactory/vfx-factory"),l=e("../services/move-validator"),u=e("../services/levels/level-service"),p=e("../services/levels/progress-service"),h=e("../states/result-state"),f=function(){function e(e){this.currentState=null,console.log("start register process states in state machine"),this.registerStates(e),console.log("end register process")}return e.prototype.registerStates=function(e){this._states={InitializeState:new c.InitializeState(this,e),CreateContentState:new n.CreateContentState(this,e.single(r.GameFactory),e.single(s.TileFactory),e.single(a.VfxFactory),e.single(p.ProgressService),e.single(u.LevelService)),GameLoopState:new i.GameLoopState(this,e.single(p.ProgressService),e.single(l.MovePlayerValidator)),ResultState:new h.ResultState(this,e.single(r.GameFactory),e.single(p.ProgressService))},console.log("States registered:",Object.keys(this._states))},e.prototype.run=function(e,t){var o,n=this._states[e];n?(null===(o=this.currentState)||void 0===o||o.stop(),this.currentState=n,n.run(t)):console.error("State not registered:",e,"/ all keys: "+Object.keys(this._states))},e}();o.StateMachine=f,cc._RF.pop()},{"../services/gameFactory/game-factory":"game-factory","../services/gameFactory/tile-factory":"tile-factory","../services/gameFactory/vfx-factory":"vfx-factory","../services/levels/level-service":"level-service","../services/levels/progress-service":"progress-service","../services/move-validator":"move-validator","../states/create-content-state":"create-content-state","../states/game-loop-state":"game-loop-state","../states/initialize-state":"initialize-state","../states/result-state":"result-state"}],game:[function(e,t,o){"use strict";cc._RF.push(t,"9468cogMLRPSL1kSlPBKw9q","game"),Object.defineProperty(o,"__esModule",{value:!0}),o.Game=void 0;var n=e("./state-machine/game-state-machine"),r=e("./state-machine/state-names");o.Game=function(e){console.log("start create state machine"),this.stateMachine=new n.StateMachine(e),console.log("this.stateMachine.run(StateNames.Initialize);  / StateArgument:",r.StateNames.Initialize),this.stateMachine.run(r.StateNames.Initialize)},cc._RF.pop()},{"./state-machine/game-state-machine":"game-state-machine","./state-machine/state-names":"state-names"}],"initialize-state":[function(e,t,o){"use strict";cc._RF.push(t,"81e10bI9VtLoLLZzzBQMAT3","initialize-state"),Object.defineProperty(o,"__esModule",{value:!0}),o.InitializeState=void 0;var n=e("../services/move-validator"),r=e("../services/gameFactory/asset-provider"),i=e("../services/gameFactory/game-factory"),c=e("../services/gameFactory/tile-factory"),s=e("../services/gameFactory/vfx-factory"),a=e("../state-machine/state-names"),l=e("../services/levels/level-service"),u=e("../services/levels/progress-service"),p=e("../../configs/configs"),h=e("../services/levels/level-config-service"),f=function(){function e(e,t){this._stateMachine=e,this._serviceLocator=t,console.log("run RegisterDependecies");var o=new r.AssetProvider,a=new i.GameFactory(o),f=new c.TileFactory(o),d=new s.VfxFactory(o),v=new h.LevelConfigService(p.GAME_CONFIG),y=new l.LevelService(v),b=new u.ProgressService(y,v.getScoreFormula()),g=new n.MovePlayerValidator;this._serviceLocator.registerSingle(o),this._serviceLocator.registerSingle(a),this._serviceLocator.registerSingle(f),this._serviceLocator.registerSingle(d),this._serviceLocator.registerSingle(b),this._serviceLocator.registerSingle(g),this._serviceLocator.registerSingle(v),this._serviceLocator.registerSingle(y),this._serviceLocator.registerSingle(b)}return e.prototype.run=function(){this._stateMachine.run(a.StateNames.CreateContent)},e.prototype.stop=function(){console.log("Stopping RegisterDependecies")},e}();o.InitializeState=f,cc._RF.pop()},{"../../configs/configs":"configs","../services/gameFactory/asset-provider":"asset-provider","../services/gameFactory/game-factory":"game-factory","../services/gameFactory/tile-factory":"tile-factory","../services/gameFactory/vfx-factory":"vfx-factory","../services/levels/level-config-service":"level-config-service","../services/levels/level-service":"level-service","../services/levels/progress-service":"progress-service","../services/move-validator":"move-validator","../state-machine/state-names":"state-names"}],"level-config-service":[function(e,t,o){"use strict";cc._RF.push(t,"fc61ax+LoJJkLKq2LHmgKOk","level-config-service"),Object.defineProperty(o,"__esModule",{value:!0}),o.LevelConfigService=void 0;var n=e("../../../configs/configs"),r=function(){function e(e){void 0===e&&(e=n.GAME_CONFIG),this._config=e}return e.prototype.getLevel=function(e){return this._config.getLevel(e)},e.prototype.getScoreFormula=function(){return this._config.getScoreFormula()},e}();o.LevelConfigService=r,cc._RF.pop()},{"../../../configs/configs":"configs"}],"level-service":[function(e,t,o){"use strict";cc._RF.push(t,"4c6f85DOGhBYYE9SRYAf+e9","level-service"),Object.defineProperty(o,"__esModule",{value:!0}),o.LevelService=void 0;var n=function(){function e(e){this._levelConfig=e,this._currentLevelId=0}return e.prototype.getCurrentLevel=function(){return this._levelConfig.getLevel(this._currentLevelId)},e.prototype.nextLevel=function(){this._currentLevelId++},e.prototype.reset=function(){this._currentLevelId=0},e}();o.LevelService=n,cc._RF.pop()},{}],"mechanic-controller":[function(e,t,o){"use strict";cc._RF.push(t,"27c3fTyvS9DDoHh15eZyjuX","mechanic-controller");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicController=void 0;var i=e("./basic-mechanic"),c=e("./booster-bomb-mechanic"),s=e("./teleport-booster-mechanic"),a=function(){function e(e,t,o){this._mechanics=[],this._activeMechanic=null,this.initMechanics(t,o,[new i.BasicMechanic(e),new c.BoosterBombMechanic(e),new s.TeleportBoosterMechanic(e)])}return e.prototype.initMechanics=function(e,t,o){this._mechanics=o,o.forEach(function(o){return o.init(e,t)});try{this.setActiveMechanic(this.getMechanicByType(i.BasicMechanic))}catch(n){throw n}},e.prototype.setActiveMechanic=function(e){console.log("set active mechanic : ",e),this._activeMechanic=e},e.prototype.getActiveMechanic=function(){return this._activeMechanic},e.prototype.getMechanicByType=function(e){return this._mechanics.find(function(t){return t instanceof e})},e.prototype.onTileClick=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this._activeMechanic?(this.onClickTile&&this.onClickTile(e),[4,this._activeMechanic.onTileClick(e)]):[2];case 1:return!t.sent()||this._activeMechanic instanceof i.BasicMechanic||this.setActiveMechanic(this.getMechanicByType(i.BasicMechanic)),[2]}})})},e.prototype.removeListeners=function(){this.onClickTile=null},e.prototype.onTurnEnd=function(){for(var e=0,t=this._mechanics;e<t.length;e++){var o=t[e];o.onTurnEnd&&o.onTurnEnd()}},e}();o.MechanicController=a,cc._RF.pop()},{"./basic-mechanic":"basic-mechanic","./booster-bomb-mechanic":"booster-bomb-mechanic","./teleport-booster-mechanic":"teleport-booster-mechanic"}],"mechanic-event-system":[function(e,t,o){"use strict";cc._RF.push(t,"88fe2Io3/xLTKHYM5wKeP0i","mechanic-event-system"),Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicEventSystem=o.MechanicEventType=void 0,(o.MechanicEventType||(o.MechanicEventType={})).MECHANIC_USED="MECHANIC_USED";var n=function(){function e(){}return e.subscribe=function(e){this.observers.push(e)},e.unsubscribe=function(e){var t=this.observers.indexOf(e);-1!==t&&this.observers.splice(t,1)},e.dispatch=function(e){for(var t=0,o=this.observers;t<o.length;t++)o[t].onMechanicEvent(e)},e.observers=[],e}();o.MechanicEventSystem=n,cc._RF.pop()},{}],"mechanic-types":[function(e,t,o){"use strict";cc._RF.push(t,"a521206bMtESISMmd/D44Th","mechanic-types"),Object.defineProperty(o,"__esModule",{value:!0}),o.MechanicType=void 0,function(e){e[e.BombBoster=0]="BombBoster",e[e.TeleportBoster=1]="TeleportBoster",e[e.Basic=2]="Basic"}(o.MechanicType||(o.MechanicType={})),cc._RF.pop()},{}],"move-validator":[function(e,t,o){"use strict";cc._RF.push(t,"7dd72tpylpLoJejIwrk8Ajo","move-validator"),Object.defineProperty(o,"__esModule",{value:!0}),o.MovePlayerValidator=void 0;var n=function(){function e(){}return e.prototype.hasPossibleMoves=function(e){for(var t=e.getTiles(),o=t.length,n=t[0].length,r=0;r<o;r++)for(var i=0;i<n;i++){var c=t[r][i];if(c)for(var s=0,a=[{x:r+1,y:i},{x:r,y:i+1},{x:r-1,y:i},{x:r,y:i-1}];s<a.length;s++){var l=a[s];if(this.isValidPosition(l.x,l.y,o,n)){var u=t[l.x][l.y];if(u&&u.tileType===c.tileType)return console.log("Found possible move for "+c.tileType),!0}}}return console.log("No possible moves found"),!1},e.prototype.isValidPosition=function(e,t,o,n){return e>=0&&e<o&&t>=0&&t<n},e}();o.MovePlayerValidator=n,cc._RF.pop()},{}],payloads:[function(e,t,o){"use strict";cc._RF.push(t,"e00a1TQw6lM56+jzcknVTK5","payloads"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"progress-controller":[function(e,t,o){"use strict";cc._RF.push(t,"a2ad2qKhE1DNqFFcSRZP32R","progress-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressController=void 0;var n=function(){function e(e,t){this.progress=e,this.levels=t}return e.prototype.getWinScoreThreshold=function(){return this.levels.getCurrentLevel().winScoreThreshold},e.prototype.getMaxStep=function(){return this.levels.getCurrentLevel().maxSteps},e.prototype.getCurrentScore=function(){return this.progress.currentScore},e.prototype.getRemainingSteps=function(){return this.progress.remainingSteps},e.prototype.onWin=function(){this.levels.nextLevel(),this.progress.resetLevel()},e.prototype.onLose=function(){this.levels.reset(),this.progress.resetLevel()},e.prototype.checkProgress=function(){this.getCurrentScore()>=this.getWinScoreThreshold()?(this.onWinEvent&&this.onWinEvent(),this.onWin()):this.getRemainingSteps()<=0&&(this.onLoseEvent&&this.onLoseEvent(),this.onLose())},e}();o.ProgressController=n,cc._RF.pop()},{}],"progress-service":[function(e,t,o){"use strict";cc._RF.push(t,"8ce93CCCP5FypBbxvbk3bTi","progress-service"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressService=void 0;var n=function(){function e(e,t){this._levelService=e,this._scoreFormula=t,this.currentScore=0,this.isGameOver=!1,this.resetLevel()}return e.prototype.getWinScoreThreshold=function(){return this._levelService.getCurrentLevel().winScoreThreshold},e.prototype.getMaxStep=function(){return this._levelService.getCurrentLevel().maxSteps},e.prototype.resetLevel=function(){var e=this._levelService.getCurrentLevel();this.remainingSteps=e.maxSteps,this.isGameOver=!1,this.currentScore=0},e.prototype.nextStep=function(e){e>1&&(this.currentScore+=this._scoreFormula(e)),this.remainingSteps--,this.checkGameOver()},e.prototype.checkGameOver=function(){return this.isGameOver=this.currentScore>=this._levelService.getCurrentLevel().winScoreThreshold||this.remainingSteps<=0},e}();o.ProgressService=n,cc._RF.pop()},{}],"result-level-controller":[function(e,t,o){"use strict";cc._RF.push(t,"03179QTKTBD65670nXGNtWo","result-level-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.ResultLevelController=void 0;var n=function(){function e(e,t){this._progressService=e,this._tableController=t}return e.prototype.clearLevel=function(){this._progressService.resetLevel(),this._tableController.clearTableModel()},e}();o.ResultLevelController=n,cc._RF.pop()},{}],"result-state":[function(e,t,o){"use strict";cc._RF.push(t,"d25fei1aFhCIJt3n5/INyLI","result-state");var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.ResultState=void 0;var i=e("../../logic/result-level-controller"),c=e("../state-machine/state-names"),s=function(){function e(e,t,o){this._stateMachine=e,this._gameFactory=t,this._progressServer=o}return e.prototype.run=function(e){return n(this,void 0,Promise,function(){var t,o=this;return r(this,function(){return new i.ResultLevelController(this._progressServer,e.tableController),t=this._gameFactory.createCurtain(),"win"===e.result?(t.win(e.message),t.onContinue=function(){o._stateMachine.run(c.StateNames.CreateContent)}):(t.lose(e.message),t.onRestart=function(){o._stateMachine.run(c.StateNames.CreateContent)}),[2]})})},e.prototype.stop=function(){},e}();o.ResultState=s,cc._RF.pop()},{"../../logic/result-level-controller":"result-level-controller","../state-machine/state-names":"state-names"}],serviceLocator:[function(e,t,o){"use strict";cc._RF.push(t,"88f5eQRvnVHrrLNqMv4pZz4","serviceLocator"),Object.defineProperty(o,"__esModule",{value:!0}),o.ServiceLocator=void 0;var n=function(){function e(){this._services=new Map}return e.Container=function(){return null==this._instance&&(console.log("start create sl instance"),this._instance=new e),this._instance},e.prototype.registerSingle=function(e){console.log("register service ",e);var t=e.constructor;this._services.set(t,e)},e.prototype.single=function(e){var t=e;console.log("get service ",t);var o=this._services.get(t);if(!o)throw new Error("Service "+t.name+" not registered");return o},e._instance=null,e}();o.ServiceLocator=n,cc._RF.pop()},{}],"state-interfaces":[function(e,t,o){"use strict";cc._RF.push(t,"29c27EKHOZP4rR/N9FD/J+j","state-interfaces"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"state-names":[function(e,t,o){"use strict";cc._RF.push(t,"65c9bUSiwlCnKTH+x0fnB4w","state-names"),Object.defineProperty(o,"__esModule",{value:!0}),o.StateNames=void 0,function(e){e.Initialize="InitializeState",e.CreateContent="CreateContentState",e.GameLoop="GameLoopState",e.ResultState="ResultState"}(o.StateNames||(o.StateNames={})),cc._RF.pop()},{}],"table-cell":[function(e,t,o){"use strict";cc._RF.push(t,"a81d6FR5B1L3J9CL7/mJKj9","table-cell"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableCell=void 0;var n=function(){function e(e,t,o,n){this._collumn=e,this._line=t,this._position=o,this._free=n}return e.prototype.getCollumn=function(){return this._collumn},e.prototype.getLine=function(){return this._line},e.prototype.getPosition=function(){return this._position},e.prototype.isFree=function(){return this._free},e.prototype.setFree=function(e){this._free=e},e}();o.TableCell=n,cc._RF.pop()},{}],"table-controller":[function(e,t,o){"use strict";cc._RF.push(t,"c9ddcY2gbtJkodXTJ05g77E","table-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableController=void 0;var n=function(){function e(e,t,o){this._tableView=e,this._model=t,this._vfxFactory=o,this.init()}return e.prototype.afterBurnGroupAction=function(e,t){var o=this,n=[],r={x:e.nodeTile.x,y:e.nodeTile.y};t.forEach(function(t){if(e!==t){var i=new Promise(function(e){o._tableView.moveTile(t,r,.2).call(function(){return e()}).start()});n.push(i)}}),Promise.all(n).then(function(){t.forEach(function(e){e.playDestroyAnimation(function(){e.nodeTile.destroy()})})})},e.prototype.onSwap=function(e){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0430 \u044d\u0442\u043e \u0445\u0430\u043a")},e.prototype.beforeBurnGroupAction=function(e,t){this._vfxFactory.createVfxMessage(e.nodeTile,"+"+t)},e.prototype.beforeBombAction=function(e,t){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0417\u0430\u0431\u0443\u0434\u044c, \u0447\u0442\u043e \u0441\u0435\u0439\u0447\u0430\u0441 \u0431\u044b\u043b\u043e +"+t)},e.prototype.init=function(){for(var e=this,t=this._model.getTiles(),o=this._model.getTableCells(),n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){var i=t[n][r];i&&this.addTileOnView(i,o[n][r])}this._model.onMoveTileAction=function(t,o){return e.moveTileOnView(t,o)},this._model.onAddTileAction=function(t,o){return e.addTileOnView(t,o)},this._model.onClearModelAction=function(t){return e.onClearTile(t)},this.onFalseBurnedAction=function(t){e._vfxFactory.createVfxMessage(t.nodeTile,"\u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u0430\u044f \u043f\u043b\u0438\u0442\u043a\u0430!"),e._tableView.showFalseBurnMessage(t)}},e.prototype.setMechanicController=function(e){this._mechanicController=e},e.prototype.onClearTile=function(e){e.removeListener()},e.prototype.onTileClick=function(e){this._mechanicController.onTileClick(e)},e.prototype.onBombAction=function(e){this._vfxFactory.createVfxBomb(e)},e.prototype.onDeselectTile=function(e){e.setActiveHightlight(!1)},e.prototype.onSelectTile=function(e){this._vfxFactory.createVfxMessage(e.nodeTile,"\u0441\u043a\u0432\u043e\u0437\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438 \u0432\u0440\u0435\u043c\u044f"),e.setActiveHightlight(!0)},e.prototype.clearTableModel=function(){this._model.clearTable()},e.prototype.removeClickTileListeners=function(){for(var e=this._model.getTiles(),t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++){var n=e[t][o];n&&n.removeListener()}},e.prototype.onFalseBurned=function(){},e.prototype.onTurnEnd=function(){this.onEndTurnAction&&this.onEndTurnAction()},e.prototype.moveTileOnView=function(e,t){this._tableView.moveTile(e,t,.3)},e.prototype.addTileOnView=function(e,t){var o=this;this._tableView.addTile(e,t),e.addListener(function(){return o.onTileClick(e)})},e}();o.TableController=n,cc._RF.pop()},{}],"table-model":[function(e,t,o){"use strict";cc._RF.push(t,"3b989ANl/JOebF4QGCb12uD","table-model"),Object.defineProperty(o,"__esModule",{value:!0}),o.TableModel=void 0;var n=function(){function e(e,t){this._tableCells=e,this._tiles=t}return e.prototype.onAddTile=function(e,t){this.onAddTileAction&&this.onAddTileAction(e,t)},e.prototype.onMoveTile=function(e,t){this.onMoveTileAction&&this.onMoveTileAction(e,t)},e.prototype.getTableCells=function(){return this._tableCells},e.prototype.getTiles=function(){return this._tiles},e.prototype.getTile=function(e,t){return this.getTiles()[e][t]},e.prototype.setTile=function(e,t,o){this.getTiles()[e][t]=o},e.prototype.getCell=function(e,t){return this.getTableCells()[e][t]},e.prototype.getTilePosition=function(e){for(var t=this.getTiles(),o=0;o<t.length;o++)for(var n=0;n<t[o].length;n++)if(t[o][n]===e)return{col:o,row:n};return{col:-1,row:-1}},e.prototype.getTileCount=function(){var e,t=this.getTiles();return{columns:t.length,rows:(null===(e=t[0])||void 0===e?void 0:e.length)||0}},e.prototype.clearTable=function(){for(var e=this.getTiles(),t=this.getTableCells(),o=0;o<e.length;o++)for(var n=0;n<e[o].length;n++){var r=e[o][n];r&&(this.onClearModelAction(r),e[o][n]=null,t[o][n].setFree(!0))}},e}();o.TableModel=n,cc._RF.pop()},{}],"table-view":[function(e,t,o){"use strict";cc._RF.push(t,"4b047pohDRFQLwMp8UszKEN","table-view");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.content=null,t.nodeView=null,t}return r(t,e),t.prototype.onLoad=function(){this.nodeView=this.node},t.prototype.getContent=function(){return this.content},t.prototype.showFalseBurnMessage=function(e){var t=e.nodeTile,o=cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.runAction(o)},t.prototype.addTile=function(e,t){e.nodeTile.setParent(this.content),e.nodeTile.setPosition(t.getPosition()),e.nodeTile.scale=0,e.nodeTile.angle=0,cc.tween(e.nodeTile).delay(.2).to(.3,{scale:1},{easing:"backOut"}).call(function(){cc.tween(e.nodeTile).to(.2,{angle:-12},{easing:"sineInOut"}).start()}).start()},t.prototype.moveTile=function(e,t,o){return cc.tween(e.nodeTile).to(o,{x:t.x,y:t.y},{easing:"quadOut"}).start()},i([a(cc.Node)],t.prototype,"content",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],"teleport-booster-mechanic":[function(e,t,o){"use strict";cc._RF.push(t,"e185985kqxHjKvbxwEKAmvv","teleport-booster-mechanic");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function c(e){try{a(n.next(e))}catch(t){i(t)}}function s(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,s)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return a([e,t])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.TeleportBoosterMechanic=void 0;var s=e("./abstract-machanic"),a=e("./mechanic-types"),l=function(e){function t(t){var o=e.call(this,t)||this;return o.firstSelectedTile=null,o.mechanicType=a.MechanicType.TeleportBoster,o}return r(t,e),t.prototype.onTileClick=function(e){return i(this,void 0,Promise,function(){var t,o;return c(this,function(){return this.firstSelectedTile&&this.firstSelectedTile.nodeTile?this.firstSelectedTile===e?(this.tableController.onDeselectTile(e),this.firstSelectedTile=null,[2,!1]):(t=this.tableModel.getTilePosition(this.firstSelectedTile),o=this.tableModel.getTilePosition(e),t&&o?(this.swapTiles(t,o,e),this.firstSelectedTile&&this.firstSelectedTile.nodeTile&&this.tableController.onDeselectTile(this.firstSelectedTile),this.firstSelectedTile=null,this.tableController.onSwap(e),[2,!0]):[2,!1]):(this.firstSelectedTile=e,console.log("first tile selected setup: ",this.firstSelectedTile.nodeTile),this.tableController.onSelectTile(e),[2,!1])})})},t.prototype.swapTiles=function(e,t,o){var n=this.tableModel.getTile(e.col,e.row),r=this.tableModel.getTile(t.col,t.row),i=this.tableModel.getTilePosition(this.firstSelectedTile),c=this.tableModel.getTilePosition(o);if(console.log("first tile type: "+n.tileType+",first tile pos:  "+JSON.stringify(i)+",\n second tile type: "+r.tileType+", second tile type: "+JSON.stringify(c)),n&&r){this.tableModel.setTile(e.col,e.row,r),this.tableModel.setTile(t.col,t.row,n);var s=this.tableModel.getCell(e.col,e.row),a=this.tableModel.getCell(t.col,t.row),l=this.tableModel.getTilePosition(this.firstSelectedTile),u=this.tableModel.getTilePosition(o);console.log("first tile type: "+n.tileType+",first tile pos:  "+JSON.stringify(l)+",\n second tile type: "+r.tileType+", second tile type: "+JSON.stringify(u)),this.tableModel.onMoveTileAction(n,a.getPosition()),this.tableModel.onMoveTileAction(r,s.getPosition()),this.dispatchUseMechanicEvent(),this.onTurnEnd()}},t.prototype.onTurnEnd=function(){this.firstSelectedTile&&(this.tableController.onDeselectTile(this.firstSelectedTile),this.firstSelectedTile=null),this.tableController.onTurnEnd()},t}(s.AbstractMechanic);o.TeleportBoosterMechanic=l,cc._RF.pop()},{"./abstract-machanic":"abstract-machanic","./mechanic-types":"mechanic-types"}],"tile-factory":[function(e,t,o){"use strict";cc._RF.push(t,"7dd77XnjD9ERaHx0St8/Xq8","tile-factory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var n=e("../../../configs/configs"),r=e("../../../logic/tile"),i=function(){function e(e){this._assetProvider=e}return e.prototype.createRandomTile=function(e){var t=this.getRandomTileModel();return this.createTile(t.tileType,t.sprite,e)},e.prototype.createTiles=function(e){for(var t=[],o=0;o<e.length;o++){t[o]=[];for(var n=0;n<e[o].length;n++){var r=e[o][n];if(r.isFree()){var i=this.getRandomTileModel(),c=this.createTile(i.tileType,i.sprite,r);r.setFree(!1),t[o][n]=c}else t[o][n]=null}}return t},e.prototype.getRandomTileModel=function(){var e=Math.random(),t=Math.floor(e*n.TILE_MODELS.length),o=n.TILE_MODELS[t],r=o.path,i=o.type,c=this._assetProvider.getAsset(r),s=new cc.SpriteFrame;return s.setTexture(c),{tileType:i,sprite:s}},e.prototype.createTile=function(e,t,o){try{var i=this._assetProvider.instantiateAsset(n.PREFABS.tilePrefab).getComponent(r.default);return i.node.setPosition(o.getPosition()),i.Init(e,t),i}catch(c){console.error("Failed to create table:",c)}},e}();o.TileFactory=i,cc._RF.pop()},{"../../../configs/configs":"configs","../../../logic/tile":"tile"}],"tile-type":[function(e,t,o){"use strict";cc._RF.push(t,"aea94/hd0xMD5AOW4/Aanlr","tile-type"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e.BLUE="blue",e.RED="red",e.GREEN="green",e.PURPLE="purple",e.YELLOW="yellow"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],tile:[function(e,t,o){"use strict";cc._RF.push(t,"9b4fe3dd5ZMh5e6wycNirgR","tile");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=e("./tile-type"),s=cc._decorator,a=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tileType=c.TileType.BLUE,t.sprite=null,t.highlight=null,t.nodeTile=null,t}return r(t,e),t.prototype.Init=function(e,t){this.nodeTile=this.node,this.tileType=e,this.sprite.spriteFrame=t,console.log("init ",this.nodeTile+" "+this.tileType+" "+this.sprite)},t.prototype.onDestroy=function(){console.log("destroy ",this.nodeTile+" "+this.tileType+" "+this.sprite)},t.prototype.addListener=function(e){this.touchHandler=e,this.sprite.node.on(cc.Node.EventType.TOUCH_END,this.touchHandler,this)},t.prototype.removeListener=function(){if(null===this.touchHandler||void 0===this.touchHandler)throw new Error("no touch handler");this.sprite.node.off(cc.Node.EventType.TOUCH_END,this.touchHandler,this)},t.prototype.setActiveHightlight=function(e){if(!this.highlight.node)throw new Error("no highlight node");this.highlight.node.active=e},t.prototype.playDestroyAnimation=function(e){cc.tween(this.node).to(.3,{scale:0},{easing:"backIn"}).delay(.5).call(e).start()},i([l],t.prototype,"tileType",void 0),i([l(cc.Sprite)],t.prototype,"sprite",void 0),i([l(cc.Sprite)],t.prototype,"highlight",void 0),i([a],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./tile-type":"tile-type"}],"ui-panel-controller":[function(e,t,o){"use strict";cc._RF.push(t,"8518arjEn9Ph5v3L4uBwp+/","ui-panel-controller"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIPanelController=void 0;var n=e("../logic/game-mechanic/booster-bomb-mechanic"),r=e("../logic/game-mechanic/teleport-booster-mechanic"),i=function(){function e(e,t,o,n,r){this._progressController=e,this._progressService=t,this._uiPanelView=o,this._mechanicService=n,this.boosterService=r,this.start()}return e.prototype.start=function(){var e=this;this._uiPanelView.init(this._progressController.getWinScoreThreshold(),this._progressService.getMaxStep()),this.updateBoostersUI(),this.boosterService.onUpdate(function(){return e.updateBoostersUI()}),this._uiPanelView.onBombButtonClick=function(){return e.onClickBombBooster()},this._uiPanelView.onTeleportButtonClick=function(){return e.onClickTeleportBooster()}},e.prototype.removeClickBoosterListeners=function(){this._uiPanelView.removeListeners(),this._mechanicService.removeListeners()},e.prototype.updateBoostersUI=function(){var e=this.boosterService.getBombTrials(),t=this.boosterService.getTeleportTrials();this._uiPanelView.updateBombCount(e),this._uiPanelView.updateTeleportCount(t),this._uiPanelView.setBombButtonActive(e>0),this._uiPanelView.setTeleportButtonActive(t>0)},e.prototype.summonClickBomb=function(){this._uiPanelView.playBombSummonAnimation()},e.prototype.updateScore=function(){this._uiPanelView.updateScore(this._progressService.currentScore),this._uiPanelView.updateStep(this._progressService.remainingSteps)},e.prototype.onClickTeleportBooster=function(){if(!(this._mechanicService.getActiveMechanic()instanceof r.TeleportBoosterMechanic)&&this.boosterService.getTeleportTrials()>0){var e=this._mechanicService.getMechanicByType(r.TeleportBoosterMechanic);this._mechanicService.setActiveMechanic(e),this._uiPanelView.playTeleportActivationAnimation()}},e.prototype.onClickBombBooster=function(){this._mechanicService.getActiveMechanic()instanceof n.BoosterBombMechanic||this.boosterService.getBombTrials()>0&&(this.setActiveBomb(),this._uiPanelView.playBombActivationAnimation())},e.prototype.setActiveBomb=function(){var e=this._mechanicService.getMechanicByType(n.BoosterBombMechanic);e?this._mechanicService.setActiveMechanic(e):console.error("bombMechanic is undefined")},e}();o.UIPanelController=i,cc._RF.pop()},{"../logic/game-mechanic/booster-bomb-mechanic":"booster-bomb-mechanic","../logic/game-mechanic/teleport-booster-mechanic":"teleport-booster-mechanic"}],"ui-panel":[function(e,t,o){"use strict";cc._RF.push(t,"954b3K6+QRPn4GSO3PV9Dl7","ui-panel");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.UiPanelView=void 0;var c=cc._decorator,s=c.ccclass,a=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepsLabel=null,t.scoreLabel=null,t.countBombLabel=null,t.bombButton=null,t.teleportButton=null,t.countTeleportLabel=null,t}return r(t,e),t.prototype.onLoad=function(){this.nodeView=this.node},t.prototype.init=function(e,t){this._winScore=e,this.stepsLabel.string=t.toString(),this.scoreLabel.string="0/"+e,this.bombButton.node.on(cc.Node.EventType.TOUCH_END,this.clickBomb,this),this.teleportButton.node.on(cc.Node.EventType.TOUCH_END,this.clickTeleport,this),this.setBombButtonActive(!0),this.setTeleportButtonActive(!0)},t.prototype.updateScore=function(e){this.scoreLabel.string=e+"/"+this._winScore,this.animateLabel(this.scoreLabel,.3)},t.prototype.updateStep=function(e){this.stepsLabel.string=e.toString(),this.animateLabel(this.stepsLabel,.5)},t.prototype.updateBombCount=function(e){this.countBombLabel.string=e.toString(),this.animateLabel(this.countBombLabel,.5)},t.prototype.setBombButtonActive=function(e){var t=this.bombButton.node;cc.Tween.stopAllByTarget(t),this.animateButton(t,e)},t.prototype.setTeleportButtonActive=function(e){var t=this.teleportButton.node;cc.Tween.stopAllByTarget(t),this.animateButton(t,e)},t.prototype.updateTeleportCount=function(e){this.countTeleportLabel.string=e.toString(),this.animateLabel(this.countTeleportLabel,.5)},t.prototype.playBombActivationAnimation=function(){this.playButtonActiveAnimation(this.bombButton.node)},t.prototype.playTeleportActivationAnimation=function(){this.playButtonActiveAnimation(this.teleportButton.node)},t.prototype.playBombSummonAnimation=function(){cc.Tween.stopAllByTarget(this.bombButton.node),cc.tween(this.bombButton.node).to(.3,{scale:1.25,color:cc.Color.RED},{easing:"sineOut"}).to(.4,{scale:1,color:cc.Color.WHITE},{easing:"sineIn"}).to(.1,{angle:-5}).to(.1,{angle:5}).to(.1,{angle:0}).repeat(10).start()},t.prototype.removeListeners=function(){this.onTeleportButtonClick=null,this.onBombButtonClick=null},t.prototype.playButtonActiveAnimation=function(e){cc.Tween.stopAllByTarget(e),e.scale=1,e.color=cc.Color.WHITE,cc.tween(e).to(.3,{scale:1.3,color:cc.Color.GREEN},{easing:"sineOut"}).to(.1,{scale:1.1}).to(.1,{scale:1.3}).to(.1,{scale:1.1}).to(.1,{scale:1.3}).to(.1,{scale:1.1}).call(function(){cc.tween(e).to(.3,{scale:1,color:cc.Color.WHITE},{easing:"sineOut"}).start()}).start()},t.prototype.clickTeleport=function(){this.onTeleportButtonClick&&this.onTeleportButtonClick()},t.prototype.clickBomb=function(){this.onBombButtonClick&&this.onBombButtonClick()},t.prototype.animateButton=function(e,t){cc.Tween.stopAllByTarget(this.node),t?(e.active=!0,e.opacity=255,e.scale=1,e.color=cc.Color.WHITE,cc.tween(e).to(.3,{scale:1.2},{easing:"sineOut"}).to(.3,{scale:1},{easing:"sineIn"}).start()):cc.tween(e).to(.25,{scale:1},{easing:"sineIn"}).call(function(){e.color=new cc.Color(180,180,180)}).start()},t.prototype.animateLabel=function(e,t){e&&e.node&&cc.tween(e.node).to(t,{scale:1.2},{easing:"sineOut"}).to(.1,{scale:1},{easing:"sineIn"}).start()},t.prototype.onDestroy=function(){var e,t,o,n;null===(t=null===(e=this.bombButton)||void 0===e?void 0:e.node)||void 0===t||t.off(cc.Node.EventType.TOUCH_END,this.clickBomb,this),null===(n=null===(o=this.teleportButton)||void 0===o?void 0:o.node)||void 0===n||n.off(cc.Node.EventType.TOUCH_END,this.clickTeleport,this)},i([a(cc.Label)],t.prototype,"stepsLabel",void 0),i([a(cc.Label)],t.prototype,"scoreLabel",void 0),i([a(cc.Label)],t.prototype,"countBombLabel",void 0),i([a(cc.Button)],t.prototype,"bombButton",void 0),i([a(cc.Button)],t.prototype,"teleportButton",void 0),i([a(cc.Label)],t.prototype,"countTeleportLabel",void 0),i([s],t)}(cc.Component);o.UiPanelView=l,cc._RF.pop()},{}],"vfx-factory":[function(e,t,o){"use strict";cc._RF.push(t,"d9958bm4g9BTb5arAZns1Ql","vfx-factory"),Object.defineProperty(o,"__esModule",{value:!0}),o.VfxFactory=void 0;var n=e("../../../configs/configs"),r=function(){function e(e){this._assetProvider=e}return e.prototype.createVfxMessage=function(e,t){try{var o=cc.director.getScene().getChildByName("Canvas"),r=this._assetProvider.instantiateAsset(n.PREFABS.LabelPrefab).getComponent(cc.Label),i=e.convertToWorldSpaceAR(cc.v2(0,0)),c=o.convertToNodeSpaceAR(i);return r.node.setParent(o),r.node.setPosition(c),r.string=t,r.node}catch(s){throw new Error("Failed to create vfx message: "+s)}},e.prototype.createVfxBomb=function(e){var t=this.createBombEffect(e.sprite.node).getComponent(cc.Sprite);t.node.active=!0,t.node.opacity=0,cc.tween(t.node).to(.3,{opacity:255},{easing:cc.easing.sineOut}).delay(1).to(.3,{opacity:0},{easing:cc.easing.sineIn}).delay(.3).call(function(){t.node.destroy()}).start()},e.prototype.createBombEffect=function(e){try{var t=cc.director.getScene().getChildByName("Canvas"),o=this._assetProvider.instantiateAsset(n.PREFABS.BombEffectPrefab),r=e.convertToWorldSpaceAR(cc.v2(0,0)),i=t.convertToNodeSpaceAR(r);return o.setParent(t),o.setPosition(i),o}catch(c){console.error("Failed to create bomb:",c)}},e}();o.VfxFactory=r,cc._RF.pop()},{"../../../configs/configs":"configs"}]},{},["configs","curtain","entry-point","game","asset-provider","game-factory","tile-factory","vfx-factory","level-config-service","level-service","progress-service","move-validator","serviceLocator","game-state-machine","payloads","state-interfaces","state-names","create-content-state","game-loop-state","initialize-state","result-state","game-loop-handler","abstract-machanic","basic-mechanic","booster-bomb-mechanic","booster-handler","game-mechanic","mechanic-controller","mechanic-event-system","mechanic-types","teleport-booster-mechanic","progress-controller","result-level-controller","table-cell","table-controller","table-model","table-view","tile-type","tile","fly-text","ui-panel-controller","ui-panel"]);